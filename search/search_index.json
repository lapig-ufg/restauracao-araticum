{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"HOME","text":""},{"location":"#documentacao-da-plataforma-da-rede-de-articulacao-pela-restauracao-do-cerrado","title":"Documenta\u00e7\u00e3o da  Plataforma da Rede de Articula\u00e7\u00e3o pela Restaura\u00e7\u00e3o do Cerrado","text":"<p>A Plataforma da Rede de Articula\u00e7\u00e3o pela Restaura\u00e7\u00e3o do Cerrado (Araticum) \u00e9 uma ferramenta online criada com o prop\u00f3sito de divulgar os dados referentes \u00e0s \u00e1reas de Restaura\u00e7\u00e3o da Rede Araticum, que \u00e9 apoiado pela WWF-Brasil, junto \u00e0s institui\u00e7\u00f5es como o Pacto pela Restaura\u00e7\u00e3o da Mata Atl\u00e2ntica, Alian\u00e7a pela Restaura\u00e7\u00e3o da Amaz\u00f4nia e muitas outras, t\u00eam como objetivo acelerar a restaura\u00e7\u00e3o nos principais biomas do pa\u00eds. At\u00e9 2030, o objetivo da institui\u00e7\u00e3o \u00e9 chegar na marca de 12 milh\u00f5es de hectares estejam restaurados ou em restaura\u00e7\u00e3o com vegeta\u00e7\u00e3o nativa, incluindo ecossistemas aqu\u00e1ticos. Desta forma,  ``O caminho \u00e9 fazer as institui\u00e7\u00f5es conversarem e fortalecer quem est\u00e1 na ponta'', aponta Thiago Belote, especialista em restaura\u00e7\u00e3o do WWF-Brasil link para not\u00edcia.</p> <p>Essa \u00e9 a documenta\u00e7\u00e3o t\u00e9cnica para a plataforma Araticum, desenvolvida pelo Laborat\u00f3rio de Processamento de Images e Geoprocessamento da Universidade Federal de Goi\u00e1s (LAPIG/UFG) no \u00e2mbito da [Rede Araticum] (https://www.instagram.com/rede.araticum/) financiado pelo WWF-Brasil.</p>"},{"location":"01-guia_dados_geograficos/","title":"Dados Geogr\u00e1ficos","text":"<p>Com o objetivo de contextualizar os desmatamentos detectados pelos sistemas PRODES-Cerrado e DETER-Cerrado, um conjunto de dados disponibilizados por diferentes institui\u00e7\u00f5es foi incorporado ao Cerrado DPAT. Alguns destes dados passaram por um processo de revis\u00e3o ou edi\u00e7\u00e3o. Essas interfer\u00eancias foram necess\u00e1rias para que dados n\u00e3o georreferenciados por meio de coordenadas (ex: lista com endere\u00e7os de armazens e frigor\u00edficos) pudessem ser incorporados ao banco de dados. </p>"},{"location":"01-guia_dados_geograficos/#desmatamento","title":"Desmatamento","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Baixar dado PRODES-Cerrado Incrementos anuais de desmatamento por corte raso registrados pelo sistema PRODES-Cerrado. 2002-2019 1:250.000 Inpe Download DETER-Cerrado Avisos de evid\u00eancias de altera\u00e7\u00e3o da vegeta\u00e7\u00e3o nativa registrados pelo sistema DETER-Cerrado. 2018-2020 1:500.000 Inpe Download \u00c1rea antr\u00f3pica M\u00e1scara de \u00e1rea acumulada de supress\u00e3o da vegeta\u00e7\u00e3o nativa at\u00e9 2000. 2000 1:250.000 Inpe Download Susceptibilidade ao desmatamento \u00c1reas com alto potencial de serem desmatadas. 2016 1:250.000 Lapig/UFG Download"},{"location":"01-guia_dados_geograficos/#areas-especiais","title":"\u00c1reas especiais","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado Terras indigenas Limite das terras ind\u00edgenas brasileiras. 2017 ND Funai Lei n\u00ba 6.001, de 19 de dezembro de 1973 Download Comunidades quilombolas Limite dos territ\u00f3rios quilombolas no Cerrado. 2020 ND Incra Download Unidades de conserva\u00e7\u00e3o Limites das unidades de conserva\u00e7\u00e3o de prote\u00e7\u00e3o integral e uso sustent\u00e1vel (federais e estaduais). 2017 ND MMA Lei n\u00ba 9.985, de 18 de julho de 2000 Download"},{"location":"01-guia_dados_geograficos/#areas-declaradas","title":"\u00c1reas declaradas","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado Propriedades rurais Propriedades rurais inscritas no Cadastro Ambiental Rural (CAR) 2020 ND SICAR Lei n\u00ba 12.651, de 25 de maio de 2012 Download Reserva Legal \u00c1rea da propriedade com a fun\u00e7\u00e3o de assegurar o uso econ\u00f4mico de modo sustent\u00e1vel dos recursos naturais do im\u00f3vel rural, auxiliar a conserva\u00e7\u00e3o e a reabilita\u00e7\u00e3o dos processos ecol\u00f3gicos e promover a conserva\u00e7\u00e3o da biodiversidade. 2020 ND SICAR Lei n\u00ba 12.651, de 25 de maio de 2012 Download \u00c1rea de Preserva\u00e7\u00e3o Permanente (APP) \u00c1rea protegida, coberta ou n\u00e3o por vegeta\u00e7\u00e3o nativa, com a fun\u00e7\u00e3o ambiental de preservar os recursos h\u00eddricos, a paisagem, a estabilidade geol\u00f3gica e a biodiversidade, facilitar o fluxo g\u00eanico de fauna e flora, proteger o solo e assegurar o bem-estar das popula\u00e7\u00f5es humana. 2020 ND SICAR Lei n\u00ba 12.651, de 25 de maio de 2012 Download Nascentes de rios Ponto correspondente ao afloramento natural do len\u00e7ol fre\u00e1tico que apresenta perenidade e d\u00e1 in\u00edcio a um curso d\u2019\u00e1gua. 2020 ND SICAR Lei n\u00ba 12.651, de 25 de maio de 2012 Download"},{"location":"01-guia_dados_geograficos/#uso-da-terra","title":"Uso da terra","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado PROBIO Cerrado Mapa de uso e cobertura da Terra. 2002 1:250.000 Minist\u00e9rio do Meio Ambiente (MMA) Mapeamento semidetalhado do uso da terra do bioma Cerrado Download TerraClass Cerrado Mapa de uso e cobertura da Terra. 2013 1:250.000 Minist\u00e9rio do Meio Ambiente (MMA) Projeto Terraclass Cerrado Download Vegeta\u00e7\u00e3o pret\u00e9rita Mapa com as fisionomias existentes antes da convers\u00e3o em \u00e1rea antr\u00ed\u00f3pica. 2019 1:250.000 IBGE Manual T\u00e9cnico da Vegeta\u00e7\u00e3o Brasileira Download Agricultura \u00c1reas cultivadas por soja, milho e algod\u00e3o durante a safra 2013/14. Safra 2013/14 1:250.000 Agrosat\u00e9lite An\u00e1lise geoespacial da din\u00e2mica das culturas anuais no bioma Cerrado - Floresta Plantada Recorte do mapeamento global de silvicultura para o bioma Cerrado disponibilizado pelo portal Global Forest Watch. 2013-2014 1:250.000 Transparent World/Global Forest Watch (GFW) Mapping Tree Plantations with Multispectral Imagery: Preliminary Results for Seven Tropical Countries Download"},{"location":"01-guia_dados_geograficos/#infraestrutura","title":"Infraestrutura","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Baixar dado Malha vi\u00e1ria Malha vi\u00e1ria (rodovias federais e estaduais) revisada a partir dos dados disponibilizados pela plataforma do OpenStreetMap. 2020 ND Open Street Maps Download Armaz\u00e9ns Localiza\u00e7\u00e3o dos armaz\u00e9ns destinados a armazenamento e controle de produ\u00e7\u00e3o no Brasil. 2017 ND Companhia Nacional de Abastecimento (CONAB)  Download Frigor\u00edficos Dado produzido a partir de informa\u00e7\u00f5es de Matadouros e/ou Frigor\u00edficos Bovinos do Brasil aptos a exporta\u00e7\u00e3o (SIF-MAPA), com localiza\u00e7\u00e3o revisada pelo LAPIG-UFG. 2017 ND Minist\u00e9rio da Agricultura, Pecu\u00e1ria e Abastecimento (MAPA) Download"},{"location":"01-guia_dados_geograficos/#geofisico","title":"Geof\u00edsico","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado Altitude Altitude em rela\u00e7\u00e3o ao nivel do mar expressa em um modelo digital de terreno (MDE-SRTM). 2000 1:150.000 (resolu\u00e7\u00e3o espacial de 30m) NASA/USGS The Shuttle Radar Topography Mission Download Declividade M\u00e9trica, expressa em porcentagem, adotada para representar a diferen\u00e7a de altura entre dois pontos e a dist\u00e2ncia horizontal entre estes dois pontos. Revela o qu\u00e3o ingreme \u00e9 o relevo. Obtida a partir dos dados altim\u00e9tricos do SRTM. 2000 1:150.000 (resolu\u00e7\u00e3o espacial de 30m) NASA/USGS The Shuttle Radar Topography Mission Download"},{"location":"01-guia_dados_geograficos/#edafoclimaticos","title":"Edafoclim\u00e1ticos","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado Solos Revis\u00e3o e convers\u00e3o para o meio digital dos levantamentos de solos produzidos pelo Projeto RADAMBRASIL. 2019 1:250.000 IBGE Manual de Pedologia Download Precipita\u00e7\u00e3o acumulada anual m\u00e9dia M\u00e9dia de precipita\u00e7\u00e3o acumulada anual, entre os anos de 2000 e 2014, obtida por meio da interpola\u00e7\u00e3o entre dados TRMM e esta\u00e7\u00f5es meteorol\u00f3gicas do INMET. 2000-2013 1:150.000 (resolu\u00e7\u00e3o espacial de 30m) TRMM/INMET - Download"},{"location":"01-guia_dados_geograficos/#acervo-de-imagens","title":"Acervo de imagens","text":"Dado Descri\u00e7\u00e3o Data Escala Fonte Detalhes Baixar dado Mosaico Landsat Imagens de sat\u00e9lite inspecionadas pelo INPE para a constru\u00e7\u00e3o do PRODES-Cerrado. 2000-2019 1:150.000 (resolu\u00e7\u00e3o espacial de 30m) NASA/USGS/INPE Landsat Missions Download Mosaico Sentinel Imagens de sat\u00e9lite com resulu\u00e7\u00e3o espacial de 10 metros, com data diferente das imagens utilizadas para a produ\u00e7\u00e3o do PRODES-Cerrado. 2018-2019 1:50.000 (resolu\u00e7\u00e3o espacial de 10m) ESA Sentinel Missions Download"},{"location":"01-guia_funcionalidades/","title":"Funcionalidades","text":""},{"location":"01-guia_funcionalidades/#dashboard","title":"Dashboard","text":"<p>O dashboard do Cerrado DPAT \u00e9 formado por cinco elementos principais:</p> <p></p> <p>1 - Controle de Visualiza\u00e7\u00e3o</p> <p>Permite o controle do n\u00edvel de zoom do mapa, al\u00e9m de ocultar e ativar a visualiza\u00e7\u00e3o da \u201cCamada de Dados\u201d. Tamb\u00e9m fornece ao usu\u00e1rio o acesso aos materiais explicativos da plataforma, tais como v\u00eddeos de eventos e tutoriais.</p> <p>2 - Camada de Dados</p> <p>Agrega todos os dados que podem ser exibidos no mapa, agrupados nas seguintes se\u00e7\u00f5es: Desmatamento; \u00c1reas Especiais; \u00c1reas Declaradas; Uso da Terra; Infraestrutura; Geof\u00edsico; Edafoclim\u00e1ticos; Acervo de Imagens. Tamb\u00e9m permite ao usu\u00e1rio, com op\u00e7\u00f5es agrupadas em abas, o controle do mapa base (Mapbox, Google Maps e Bing), dos limites que s\u00e3o mostrados no mapa, e o upload de uma \u00e1rea de interesse que pode ser enviada nos formatos shapefile, geojson e kml.</p> <p></p> <p>3 - Mapa interativo</p> <p>\u00c1rea onde todas as camadas de dados s\u00e3o visualizadas.</p> <p>4 - Legenda</p> <p>Legenda correspondente \u00e0s camadas de dados habilitadas para visualiza\u00e7\u00e3o.</p> <p>5 - Estat\u00edsticas de Desmatamento sobre o PRODES-Cerrado</p> <p>Exp\u00f5e as estat\u00edsticas de desmatamento e uso do solo de acordo com a unidade de an\u00e1lise escolhida pelo usu\u00e1rio (Estado ou Munic\u00edpio). Por padr\u00e3o, exibe para todo o bioma Cerrado, o total anual da \u00e1rea desmatada no per\u00edodo 2000-2019. De acordo com o ano de interesse do usu\u00e1rio e, a partir do cruzamento com dados do Cadastro Ambiental Rural (CAR), tamb\u00e9m apresenta o total desmatado em \u00c1rea de Preserva\u00e7\u00e3o Permanente (APP) e em Reserva Legal (RL) nos dez munic\u00edpios com a maior \u00e1rea desmatada dentro destas categorias.</p> <p></p>"},{"location":"01-guia_funcionalidades/#visualizacao-das-areas-desmatadas","title":"Visualiza\u00e7\u00e3o das \u00e1reas desmatadas","text":"<p>Essa se\u00e7\u00e3o tem por objetivo espacializar o total desmatado, detectado em cada ano, pelos sistemas PRODES-Cerrado e DETER-Cerrado. Estes dados podem ser ativados para dois n\u00edveis: munic\u00edpio e pol\u00edgono.</p> <p></p> <p>Destaca-se tamb\u00e9m a possibilidade de ativar os pol\u00edgonos interseccionados com propriedades participantes do projeto FIP ABC, assim como todas as \u00e1reas desmatadas visitadas em campo, com os respectivos dados coletados em cada \u00e1rea. Uma outra forma de visualiza\u00e7\u00e3o do dado PRODES-Cerrado \u00e9 por total acumulado anual. Ou seja, a \u00e1rea antr\u00f3pica total do bioma Cerrado para cada ano.</p> <p>Para verificar a suscetibilidade ao desmatamento dos pol\u00edgonos detectados a partir de 2016, foram criadas duas superf\u00edcies. Estas camadas, com resolu\u00e7\u00e3o de 100m, foram concebidas a partir dos padr\u00f5es observados nos desmatamentos pequenos (&lt; 0,5 km\u00b2) e grandes (&gt; 0,5 km\u00b2) ocorridos entre os anos de 2010 e 2015.</p>"},{"location":"01-guia_funcionalidades/#upload-de-dados-geograficos","title":"Upload de dados geogr\u00e1ficos","text":"<p>Considerando as necessidades espec\u00edficas de cada usu\u00e1rio da ferramenta Cerrado DPAT, a aba \u201cUpload\u201d (localizada na \u201cCamada de Dados\u201d) permite a submiss\u00e3o de arquivos shapefile e geojson (compactados em .zip) ou .kml e .kmz (produzidos pelo Google Earth). Ap\u00f3s a submiss\u00e3o do arquivo espacial, os limites da \u00e1rea de interesse j\u00e1 podem ser visualizados no mapa. Um token, num\u00e9rico e em QR Code, tamb\u00e9m \u00e9 criado para eventuais compartilhamentos.</p> <p></p>"},{"location":"01-guia_metricas_de_qualidade/","title":"M\u00e9tricas de Qualidade","text":""},{"location":"01-guia_metricas_de_qualidade/#processos-de-validacao","title":"Processos de valida\u00e7\u00e3o","text":""},{"location":"01-guia_metricas_de_qualidade/#campo","title":"Campo","text":"<p>Durante a vig\u00eancia do projeto FIP Monitoramento foram realizadas quatro atividades de campo. Essas atividades foram conduzidas com o prop\u00f3sito de coletar dados que pudesse subsidiar tanto o processo de valida\u00e7\u00e3o dos produto PRODES-Cerrado e DETER-Cerrado, quanto a calibra\u00e7\u00e3o dos crit\u00e9rios utilizados durante o processo de inspe\u00e7\u00e3o visual realizado no \u00e2mbito da valida\u00e7\u00e3o amostral.</p> <p></p>"},{"location":"01-guia_metricas_de_qualidade/#validacao-amostral","title":"Valida\u00e7\u00e3o amostral","text":"<p>Uma valida\u00e7\u00e3o amostral foi realizada, a partir da interpreta\u00e7\u00e3o visual em imagens de sat\u00e9lite, para o mapa PRODES-Cerrado com as classes referentes ao desmatamentos realizados at\u00e9 o ano de 2019. A an\u00e1lise do resultado deste processo proporcionou a publica\u00e7\u00e3o do artigo \"Quality assessment of the PRODES Cerrado deforestation data\" na revista acad\u00eamica Remote Sensing Applications: Society and Environment. </p>"},{"location":"01-guia_metricas_de_qualidade/#analises-automaticas","title":"An\u00e1lises autom\u00e1ticas","text":""},{"location":"01-guia_metricas_de_qualidade/#superficie-de-susceptibilidade-ao-desmatamento","title":"Superf\u00edcie de Susceptibilidade ao Desmatamento","text":"<p>Duas superf\u00edcies de susceptibilidade foram criadas com o prop\u00f3sito de espacializar as \u00e1reas com alto potencial para desmatamentos pequenos e grandes. Estes produtos foram obtidas a partir da compila\u00e7\u00e3o de 11 m\u00e9tricas espacialmente explicitas, a verifica\u00e7\u00e3o dos respectivos pesos na ocorr\u00eancia de eventos de supress\u00e3o da vegeta\u00e7\u00e3o nativa e a espacializa\u00e7\u00e3o da probabilidade de ocorr\u00eancia deste fen\u00f4meno.</p> <p></p> <p>O exemplo abaixo apresenta a superf\u00edcie de susceptibilidade aos desmatamentos grandes no Oeste Baiano juntamente com os pol\u00edgonos detectados pelo PRODES-Cerrado 2016 e 2017. Observa-se que diversos pol\u00edgonos com \u00e1reas grandes se encontram na regi\u00e3o com alta susceptibilidade a desmatamentos grandes, enquanto desmatamentos com pequenas \u00e1reas est\u00e3o localizados em \u00e1rea menos suscept\u00edveis a desmatamentos maiores que 0,5 km\u00b2. Com isto, pode-se observar a boa ader\u00eancia do modelo em rela\u00e7\u00e3o aos dados do PRODES-Cerrado. Os detalhes da sua constru\u00e7\u00e3o podem ser visualizados aqui</p> <p> </p> <p>Publica\u00e7\u00f5es:  </p> <ul> <li>A deforestation probability surface in support of the vegetation monitoring in the Brazilian Cerrado biome </li> <li>Deforestation Polygon Assessment Tool: Providing comprehensive information on deforestation in the brazilian Cerrado biome </li> </ul>"},{"location":"01-guia_metricas_de_qualidade/#b-fast-monitor","title":"B-Fast Monitor","text":"<p>A quebra da tend\u00eancia temporal, a partir de 2015, dos valores de NDVI referentes a cada pixel MODIS, com resolu\u00e7\u00e3o espacial de 250 metros, presente nos pol\u00edgonos detectados pelo PRODES-Cerrado, foi verificada pelo m\u00e9todo B-Fast Monitor.</p> <p>Ap\u00f3s a sua execu\u00e7\u00e3o, entre 2016 e 2018 (i.e. 525.038 pixels), foi observado que cerca de 82% dos pol\u00edgonos apresentaram pixels com quebras em suas s\u00e9ries temporais, e dentre estes, pol\u00edgonos com \u00e1rea de pelo menos 0,25 km\u00b2 apresentaram mais de 50% dos pixels com quebras, um indicativo da efici\u00eancia deste m\u00e9todo em detectar desmatamentos grandes. Em contrapartida, os pol\u00edgonos que apresentaram at\u00e9 25% de pixels com quebra representam cerca de 46% do total de pol\u00edgonos do PRODES-Cerrado, por\u00e9m este valor \u00e9 equivalente a uma \u00e1rea total de 2.369 km\u00b2, que representa apenas 11% do total desmatamento entre 2016 e 2018.</p> <p></p> <p>A figura acima apresenta um exemplo de pol\u00edgono de desmatamento detectado pelo PRODES-Cerrado em 2017 e tamb\u00e9m confirmado automaticamente pelo Bfast-Monitor. Nela \u00e9 poss\u00edvel observar um pol\u00edgono com uma \u00e1rea total de 18 km\u00b2 no munic\u00edpio de Mateiros-TO, onde sua imagem MODIS apresenta 350 pixels sendo que 218 destes sofreram rupturas.</p> <p>Por fim, \u00e9 importante ressaltar que do total de 21.869 km\u00b2 de \u00e1reas desmatadas entre 2016 e 2018 no bioma Cerrado, o Bfast-Monitor foi capaz de identificar 15.550 km\u00b2 de pol\u00edgonos que apresentaram pelo menos 50% de quebras em suas s\u00e9ries temporais, o que representa ~71% do total. Nas demais \u00e1reas tamb\u00e9m foram identificados pixels com quebras, por\u00e9m em menor propor\u00e7\u00e3o, o que indica a presen\u00e7a de desmatamento de tamanho inferior a 0,25 km\u00b2, o que devido a resolu\u00e7\u00e3o do pixel MODIS se torna mais dif\u00edcil de ser identificado. De forma geral, foi poss\u00edvel observar uma converg\u00eancia entre os resultados gerados pelo Bfast-Monitor e os dados divulgados pelo PRODES-Cerrado.  </p> <p>Publica\u00e7\u00f5es:  </p> <ul> <li>Assessing land-cover changes in the Brazilian Cerrado biome based on the time-series analysis of MODIS and Landsat datasets </li> <li>Deforestation Polygon Assessment Tool: Providing comprehensive information on deforestation in the Brazilian Cerrado biome </li> </ul>"},{"location":"01-guia_relatorios/","title":"Relat\u00f3rios","text":""},{"location":"01-guia_relatorios/#relatorio-do-estadomunicipio","title":"Relat\u00f3rio do estado/municipio","text":"<p>O Cerrado DPAT permite a visualiza\u00e7\u00e3o de estat\u00edsticas e camadas para cada um dos estados e 1.386 munic\u00edpios do bioma Cerrado. Estes munic\u00edpios podem ser selecionados por meio de uma busca r\u00e1pida localizada na \u201cCamada de Dados\u201d. Assim, um zoom \u00e9 aplicado para a \u00e1rea de interesse, junto com estat\u00edsticas referentes \u00e0 s\u00e9rie hist\u00f3rica dos dados PRODES-Cerrado, uso e cobertura do solo no ano de 2013 (dados Terraclass Cerrado), e \u00e1rea agr\u00edcola mapeada durante a safra 2013/14 (dados Agrosat\u00e9lite). Al\u00e9m dos dados previamente carregados, destaca-se tamb\u00e9m a possibilidade da ativa\u00e7\u00e3o de todas as camadas de dados (e.g., declividade, solos, susceptibilidade ao desmatamento, precipita\u00e7\u00e3o, unidades de conserva\u00e7\u00e3o, terras ind\u00edgenas, terras quilombolas, dados do CAR, florestas plantadas, silos e armaz\u00e9ns, rodovias e frigor\u00edficos pertencentes ao sistema de inspe\u00e7\u00e3o federal).</p> <p></p>"},{"location":"01-guia_relatorios/#relatorio-do-poligono","title":"Relat\u00f3rio do pol\u00edgono","text":"<p>Com o prop\u00f3sito de contextualizar cada \u00e1rea desmatada pelo PRODES-Cerrado, tamb\u00e9m apresentamos um relat\u00f3rio individual para cada pol\u00edgono detectado. Este relat\u00f3rio apresenta seis se\u00e7\u00f5es: Informa\u00e7\u00f5es Sobre o Pol\u00edgono, \u00c1reas Especiais, Cadastro Ambiental Rural (CAR), Valida\u00e7\u00e3o de Campo, Valida\u00e7\u00e3o Amostral e Hist\u00f3rico de Imagens Landsat, e, An\u00e1lise Autom\u00e1tica.</p> <p></p> <p>A primeira se\u00e7\u00e3o apresenta os dados disponibilizados pelo INPE para cada detec\u00e7\u00e3o: sistema (PRODES-Cerrado ou DETER-Cerrado), \u00e1rea desmatada (em km\u00b2), munic\u00edpio, estado, data de detec\u00e7\u00e3o, latitude, longitude al\u00e9m dos limites do desmatamentos sobre a imagem inspecionada pelo INPE para a sua respectiva detec\u00e7\u00e3o. Nesta mesma se\u00e7\u00e3o \u00e9 informado a classe atribu\u00edda ao pol\u00edgono (A, B, C, D ou E).</p> <p></p> <p>A se\u00e7\u00e3o \u201c\u00c1reas Especiais\u201d apresenta a dist\u00e2ncia do pol\u00edgono em rela\u00e7\u00e3o \u00e0 Terra Ind\u00edgena, Unidade de Conserva\u00e7\u00e3o (Uso Sustent\u00e1vel e Prote\u00e7\u00e3o Integral) e \u00c1rea Quilombola mais pr\u00f3xima. No caso de intersec\u00e7\u00e3o com alguma destas \u00e1reas, ou se a \u00e1rea estiver dentro de uma dist\u00e2ncia de 10 km, a localiza\u00e7\u00e3o do pol\u00edgono \u00e9 mostrada em conjunto com os respectivos limites da \u00e1rea especial em quest\u00e3o.</p> <p></p> <p>As intersec\u00e7\u00f5es do pol\u00edgono desmatado com os dados do CAR (limite da propriedade, APP, Reserva Legal e Nascentes), assim como as \u00e1reas (km\u00b2) de cada uma destas intersec\u00e7\u00f5es, s\u00e3o apresentadas na se\u00e7\u00e3o \u201cCadastro Ambiental Rural (CAR)\u201d.</p> <p></p> <p>Os dados coletados nas atividades de campo realizadas no \u00e2mbito do projeto FIP Monitoramento s\u00e3o disponibilizadas ao p\u00fablico por meio da se\u00e7\u00e3o \u201cValida\u00e7\u00e3o de Campo\u201d. Nela s\u00e3o apresentadas tanto fotos registradas em solo, quanto fotos e v\u00eddeos a\u00e9reos registrados por drones.</p> <p></p> <p>Na se\u00e7\u00e3o \u201cValida\u00e7\u00e3o Amostral e Hist\u00f3rico de Imagens Landsat\u201d, o usu\u00e1rio da plataforma tem acesso \u00e0s imagens inspecionadas para a detec\u00e7\u00e3o dos desmatamentos no \u00e2mbito do sistema PRODES-Cerrado. Tamb\u00e9m s\u00e3o disponibilizados os pontos visualmente inspecionados no \u00e2mbito da valida\u00e7\u00e3o amostral realizada pelo Laborat\u00f3rio de Processamento de Imagens e Geoprocessamento (Lapig) da Universidade Federal de Goi\u00e1s (UFG).</p> <p></p> <p>As composi\u00e7\u00f5es adotadas para os sensores Landsat TM (R4 G5 B3) e Landsat OLI (R5 G6 4B) real\u00e7am, em vermelho, a vegeta\u00e7\u00e3o fotossinteticamente ativa. Os tons esverdeados correspondem tanto a \u00e1reas com vegeta\u00e7\u00e3o esparsa e  baixo porte (textura heterog\u00eanea) quanto solo exposto (textura homog\u00eanea). Cicatrizes de queimadas s\u00e3o observadas na cor azul escuro, solos expostos podem ser observados na cor azul clara, e palhada de agricultura, em tonalidades esbranqui\u00e7adas.</p> <p>Ap\u00f3s a visualiza\u00e7\u00e3o da s\u00e9rie hist\u00f3rica de imagens Landsat, uma s\u00e9rie temporal obtida pelo sensor MODIS a partir de valores mensais do \u00edndice de vegeta\u00e7\u00e3o Normalized Difference Vegetation Index (NDVI), tamb\u00e9m permite uma melhor compreens\u00e3o sazonal do comportamento da vegeta\u00e7\u00e3o desmatada.</p> <p>Por fim, uma an\u00e1lise autom\u00e1tica \u00e9 aplicada a todos os pol\u00edgonos de desmatamento  identificados. Ela se constitui de contextualiza\u00e7\u00f5es geogr\u00e1ficas e espectro temporais, respectivamente representadas pela superf\u00edcie de susceptibilidade ao desmatamento (desmatamentos grandes e pequenos) e pelo resultado do uso do algoritmo B-Fast Monitor (utilizada para a detec\u00e7\u00e3o de quebras de tend\u00eancias em s\u00e9ries temporais) em s\u00e9ries MODIS.</p> <p></p>"},{"location":"01-guia_relatorios/#relatorio-da-area-submetida","title":"Relat\u00f3rio da \u00e1rea submetida","text":"<p>Ap\u00f3s o envio do arquivo espacializado, o usu\u00e1rio tem a op\u00e7\u00e3o de analisar a \u00e1rea submetida com um clique sobre o bot\u00e3o \u201cAnalisar\u201d. Essa an\u00e1lise permite a visualiza\u00e7\u00e3o de um relat\u00f3rio com a \u00e1rea total, os munic\u00edpios, e os estados que cruzam com a \u00e1rea submetida. Tamb\u00e9m s\u00e3o expostas as \u00e1reas totais anuais dos avisos provenientes do DETER-Cerrado e dos desmatamentos detectados pelo PRODES-Cerrado.</p> <p></p> <p>Observa-se na figura abaixo a sobreposi\u00e7\u00e3o de desmatamentos (contorno em rosa) com uma \u00c1rea Priorit\u00e1ria Para Conserva\u00e7\u00e3o da Biodiversidade (Entorno da Terra Indigena Xerente) de Import\u00e2ncia Biol\u00f3gica \u201cExtremamente Alta\u201d e Prioridade de A\u00e7\u00e3o \u201cExtremamente Alta\u201d. Tamb\u00e9m \u00e9 poss\u00edvel identificar, em vermelho, as \u00e1reas nativas mais suscept\u00edveis ao desmatamento.</p> <p></p> <p>Destaca-se tamb\u00e9m a funcionalidade de visualiza\u00e7\u00e3o dos registros CAR referentes aos 50 maiores desmatamentos detectados dentro da \u00e1rea submetida. Al\u00e9m do c\u00f3digo da respectiva propriedade, tamb\u00e9m s\u00e3o disponibilizados dados de \u00e1rea desmatada por CAR (km\u00b2), \u00e1rea de reserva legal total da propriedade (km\u00b2), \u00e1rea desmatada em reserva legal (km\u00b2), \u00e1rea total de APP da propriedade (km\u00b2) e \u00e1rea desmatada em APP da propriedade (km\u00b2).</p> <p></p>"},{"location":"02-arq_execucao_dpat/","title":"Introdu\u00e7\u00e3o","text":"<p>Conforme detalhado na se\u00e7\u00e3o Arquitetura de Software, para execu\u00e7\u00e3o do Cerrado DPAT s\u00e3o necess\u00e1rias 3 estruturas criadas e funcionais na m\u00e1quina do usu\u00e1rio:</p> <ol> <li> <p>O Banco de Dados <code>fip_cerrado</code> restaurado no servi\u00e7o do PostgreSQL devidamente instalado com a extens\u00e3o PostGis.</p> </li> <li> <p>O servi\u00e7o OWS Server devidamente configurado e executando em um IP e porta.</p> </li> <li> <p>O Application Server e client (Front-end) da aplica\u00e7\u00e3o compilados e executando.</p> </li> </ol>"},{"location":"02-arq_execucao_dpat/#restaurando-e-disponibilizando-o-banco-de-dados-fip-cerrado","title":"Restaurando e disponibilizando o banco de dados FIP-Cerrado","text":"<p>Para restaurar o banco <code>fip_cerrado</code> no PostgreSQL, \u00e9 necess\u00e1rio ter o servi\u00e7o PostgreSQL executando na m\u00e1quina do usu\u00e1rio. Para tal, pode-se utilizar o tutorial neste link para instalar e executar o PostgreSQL e o PGAdmin3.</p> <p>Ao final do tutorial, deve-se verificar qual a vers\u00e3o do PostgreSQL instalado (ver: link) e tamb\u00e9m instalar a extens\u00e3o do Postgis para a vers\u00e3o adequada de acordo com o tutorial deste link no Step 4: Install PostGIS on Ubuntu 20.04/18.04 / Debian 10.</p> <p>Com o PostgreSQL e o PostGIS instalados, em seguida \u00e9 necess\u00e1rio realizar o download do \u00faltimo backup disponibilizado no endere\u00e7o e extra\u00ed-lo.</p> <pre><code>$ tar -xfv BKP_BANCO_DADOS_FIP_CERRADO.tar.gz\n</code></pre> <p>Em seguida, deve-se exportar a vari\u00e1vel de senha do banco de dados configurada anteriormente.</p> <pre><code>$ export PGPASSWORD= &lt;db_password&gt;\n</code></pre> <p>Ap\u00f3s exporta\u00e7\u00e3o da senha, deve criar o banco de dados no servi\u00e7o PostgreSQL. Este passo pode ser realizado por linha de comando ou com ajuda do PGAdmin3. Ambos os passos est\u00e3o demonstrados abaixo.</p> <pre><code>$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -c \"create database fip_cerado;\"\n</code></pre> <p></p> <p>Ap\u00f3s a cria\u00e7\u00e3o do banco de dados, deve-se criar as extens\u00f5es do PostGis e PlPGSql para uso das fun\u00e7\u00f5es na aplica\u00e7\u00e3o.</p> <pre><code>$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d fip_cerrado -c \"create extension postgis;\"\n$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d fip_cerrado -c \"create extension plpgsql;\"\n</code></pre> <p>Agora de fato pode-se restaurar o banco de dados baixado e extra\u00eddo para a database <code>fip_cerrado</code> criada, o que pode ser alcan\u00e7ada atrav\u00e9s do comando.</p> <pre><code>$ pg_restore -U fip_cerrado -h &lt;host_address&gt; -v -j 24 --format=d -C -d fip_cerrado fip_cerrado.sql/\n</code></pre> <p>Por fim, com o banco restaurado, deve-se criar/executar algumas fun\u00e7\u00f5es auxiliares SQL para cria\u00e7\u00e3o das Materialized Views e algumas fun\u00e7\u00f5es SQL customizadas para o Cerrado DPAT. Para tal, deve-se acessar o arquivo .sql e execut\u00e1-lo da seguinte forma:</p> <pre><code>$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d fip_cerrado -a -f &lt;ImportantFunctions.sql&gt;\n</code></pre>"},{"location":"02-arq_execucao_dpat/#deployment-do-ows-server","title":"Deployment do OWS Server","text":"<p>A fim facilitar/automatizar todo o processo de execu\u00e7\u00e3o do OWS Server foi criado um script que executa todos os passos necess\u00e1rios. Este script dever\u00e1 executar as seguintes tarefas:</p> <ul> <li>Download do cont\u00e2iner do OWS Server presente no endere\u00e7o</li> <li>Cria a estrutura de pastas necess\u00e1rias (ows-cache, catalog e dpat-files) para funcionamento do OWS Server.</li> <li>Constr\u00f3i a aplica\u00e7\u00e3o do OWS Server e a disponibiliza em um IP e porta.</li> </ul> <p>Conforme mencionado anteriormente, a estrutura do OWS Server foi constru\u00edda com o apoio do Docker, portanto para instala\u00e7\u00e3o do mesmo, deve-se seguir os passos definidos nos tutoriais de acordo com o sistema operacional, seja ele Debian ou CentOS. Al\u00e9m do Docker, o script tamb\u00e9m faz uso das seguintes depend\u00eancias:</p> Depend\u00eancia Tutorial para Instala\u00e7\u00e3o Perl https://learn.perl.org/installing/unix_linux.html wget https://www.cyberciti.biz/faq/how-to-install-wget-togetrid-of-error-bash-wget-command-not-found/ curl https://www.cyberciti.biz/faq/how-to-install-curl-command-on-a-ubuntu-linux/ Git https://gist.github.com/derhuerst/1b15ff4652a867391f03 <p>Ap\u00f3s instala\u00e7\u00e3o do Docker e das depend\u00eancias m\u00ednimas para o script, deve-se executar o script <code>start-ows.sh</code> atrav\u00e9s do comando:</p> <pre><code>$ ./start-ows.sh\n</code></pre> <p>Inicialmente o script ir\u00e1 pedir ao usu\u00e1rio que informe o local onde o OWS dever\u00e1 criar a estrutura de pastas necess\u00e1rias para funcionamento. Na imagem abaixo, o usu\u00e1rio ter\u00e1 informado o caminho <code>/mnt/hd02</code>. \u00c9 importante ressaltar que este dever\u00e1 ser um caminho v\u00e1lido na m\u00e1quina do usu\u00e1rio, por\u00e9m, como o OWS Server est\u00e1 armazenado em um cont\u00e2iner Docker, o script ir\u00e1 mapear automaticamente este caminho para <code>/STORAGE</code> dentro da estrutura do Docker.</p> <p></p> <p>Em seguida, deve-se informar o diret\u00f3rio onde o cache dever\u00e1 ser armazenado. Na imagem abaixo, o usu\u00e1rio ter\u00e1 informado novamente o caminho <code>/mnt/hd02</code>.</p> <p></p> <p>Em seguida, o script ir\u00e1 pedir para que o usu\u00e1rio informe o host (endere\u00e7o) de onde est\u00e1 rodando o servi\u00e7o do Banco de dados PostgreSQL, bem como, a porta de execu\u00e7\u00e3o, o nome do banco de dados e a senha do banco. Estes dados s\u00e3o necess\u00e1rios para configurar o acesso do Mapserver ao banco de dados a fim de criar as camadas de dados vetoriais.</p> <p></p> <p></p> <p></p> <p></p> <p>Ap\u00f3s a inicializa\u00e7\u00e3o do das vari\u00e1veis necess\u00e1rias para conectar o OWS Server com o banco de dados, o script ir\u00e1 realizar automaticamente o download do cont\u00e2iner do OWS Server e import\u00e1-lo corretamente no Docker instalado na m\u00e1quina do usu\u00e1rio.</p> <p></p> <p>Ap\u00f3s a importa\u00e7\u00e3o correta do cont\u00e2iner, o OWS Server dever\u00e1 estar executando e aguardando requisi\u00e7\u00f5es em localhost ou 127.0.0.1 na porta 5000. A imagem abaixo apresenta um exemplo de requsi\u00e7\u00e3o feita atrav\u00e9s do curl no endere\u00e7o <code>http://127.0.0.1:5000/ows</code>, que recebe uma pequena p\u00e1gina HTML criada pelo MapServer.</p> <p></p> <p>Ap\u00f3s a execu\u00e7\u00e3o do OWS Server, tamb\u00e9m \u00e9 necess\u00e1rio mover os arquivos Raster presentes no link para dentro da pasta <code>catalog</code> criada no caminho informado pelo usu\u00e1rio no in\u00edcio do script.</p> <p>Por fim, vale ressaltar que uma vez que o cont\u00e2iner do OWS Server esteja configurado e funcionando n\u00e3o \u00e9 mais necess\u00e1rio executar o script <code>start-ows.sh</code>. J\u00e1 existe um script na raiz do cont\u00e2iner que \u00e9 respons\u00e1vel por executar o OWS Server imediatamente ap\u00f3s o cont\u00e2iner ser inicializado. Portanto, basta executar:</p> <pre><code>$ docker restart OWS bash\n</code></pre> <p>E caso deseja entrar no cont\u00e2iner e verificar os arquivos internos, tais como logs de requisi\u00e7\u00f5es, basta executar:</p> <pre><code>$ docker exec -it OWS bash\n$ cd /APP/lapig-maps/src/ows/log\n$ tail -f ows-mapserv.log\n</code></pre>"},{"location":"02-arq_execucao_dpat/#deployment-da-aplicacao-cerrado-dpat","title":"Deployment da aplica\u00e7\u00e3o Cerrado DPAT","text":"<p>Para execu\u00e7\u00e3o do Cerrado DPAT \u00e9 importante ressaltar que o Banco de Dados deve estar restaurado e acess\u00edvel conforme abordado na se\u00e7\u00e3o e tamb\u00e9m deve-se ter o OWS Server funcionando corretamente.</p> <p>A seguir ser\u00e1 abordado duas maneiras de executar a aplica\u00e7\u00e3o Cerrado DPAT em ambientes de Desenvolvimento e Produ\u00e7\u00e3o. Para o ambiente de desenvolvimento ser\u00e1 detalhado um passo a passo partindo do pressuposto que um programador ir\u00e1 dar manuten\u00e7\u00e3o ou continuidade no Cerrado DPAT. J\u00e1 o ambiente de produ\u00e7\u00e3o, ser\u00e1 disponibilizado um script que executa todos os passos para disponibilizar o Cerrado DPAT em uma porta da m\u00e1quina que est\u00e1 sendo executado. </p> <p>Em seguida, certifique-se de criar corretamente um arquivo <code>.env</code> conforme abordado na se\u00e7\u00e3o. Um exemplo de arquivo <code>.env</code> criado durante o processo de execu\u00e7\u00e3o do script para o ambiente de Produ\u00e7\u00e3o pode ser observado abaixo:</p> <pre><code>APP_PRODUCAO='/STORAGE/dpat-files'\nCLIENT_DIR='/../client/dist/lapig-dpat/'\nLANG_DIR='/lang'\nLOG_DIR='/log/'\nTMP='/tmp/'\nFIELD_DATA_DIR='/campo-dpat/'\nUPLOAD_DATA_DIR='/upload-dpat/'\nDOWNLOAD_DATA_DIR='/download-dpat/'\n\nPG_USER='db_user'\nPG_HOST='127.0.0.1'\nPG_DATABASE='fip_cerrado'\nPG_PASSWORD='db_password'\nPG_PORT='db_port'\nPG_DEBUG=true\n\nPORT=3000\nOWS_HOST='http://172.18.0.8:5000'\nOWS_DOMAINS='http://172.18.0.8:5000'\nNDVI_DOMAIN='127.0.0.1:4200'\n</code></pre>"},{"location":"02-arq_execucao_dpat/#ambiente-de-desenvolvimento","title":"Ambiente de Desenvolvimento","text":"<p>Assim como abordado na se\u00e7\u00e3o, o Cerrado DPAT foi constru\u00eddo com NodeJS como Application Server e Angular como cliente (WebMap Client). Portanto, primeiramente \u00e9 necess\u00e1ria a instala\u00e7\u00e3o destes componentes na m\u00e1quina do desenvolvedor. Para tal, pode-se seguir o passo-a-passo elaborado neste link</p> <p>Para execu\u00e7\u00e3o do Cerrado DPAT em ambiente de desenvolvimento, primeiramente \u00e9 necess\u00e1rio realizar um <code>fork</code> do projeto para a sua conta pessoal do Github e em seguida executar um <code>git clone</code> do reposit\u00f3rio do projeto.</p> <p>Para inicializar o servidor de aplica\u00e7\u00e3o (Application Server) deve-se executar o passo-a-passo descrito na se\u00e7\u00e3o. A execu\u00e7\u00e3o da mesma ir\u00e1 inicializar o Application Server em localhost na porta 3000. Para verificar o seu funcionamento, pode-se realizar a requisi\u00e7\u00e3o abaixo em um navegador qualquer, que dever\u00e1 apresentar um resultado semelhante a este.</p> <pre><code>http://localhost:3000/service/deforestation/largest?year=2019&amp;amount=15\n</code></pre> <p>Em seguida, para inicializar o WebMap Client localizado na pasta <code>src/client</code>, basta navegar at\u00e9 a pasta client e instalar as depend\u00eancias listadas no package.json atrav\u00e9s do comando:</p> <pre><code>$ npm install\n</code></pre> <p>Ap\u00f3s a devida instala\u00e7\u00e3o das depend\u00eancias, pode-se ent\u00e3o compilar e inicializar a aplica\u00e7\u00e3o. Mais uma vez, a fim de facilitar, foi criado um script <code>start.sh</code> para inicializar o WebMap Client, portanto basta executar:</p> <pre><code>$ ./src/client/start.sh\n</code></pre> <p>Ao finalizar a compila\u00e7\u00e3o do projeto, a aplica\u00e7\u00e3o estar\u00e1 executando em localhost na porta padr\u00e3o do Angular, que \u00e9 a porta 4200. Portanto, para acessar a p\u00e1gina Web criada pela aplica\u00e7\u00e3o, acesse pelo navegador:</p> <pre><code>http://localhost:4200\n</code></pre>"},{"location":"02-arq_execucao_dpat/#ambiente-de-producao","title":"Ambiente de Produ\u00e7\u00e3o","text":"<p>Em seguida, uma segunda maneira de disponibilizar o Cerrado DPAT \u00e9 em ambiente de produ\u00e7\u00e3o. \u00c9 importante ressaltar que o OWS Server deve estar executando para que o Cerrado DPAT fa\u00e7a as requisi\u00e7\u00f5es de imagens das diferentes camadas utilizadas pelo sistema.</p> <p>Para facilitar o processo de deployment em produ\u00e7\u00e3o, foi criado um script que realiza todos os passos necess\u00e1rios para execu\u00e7\u00e3o do Cerrado DPAT em produ\u00e7\u00e3o. Para executar o script basta executar em um Terminal:</p> <pre><code>$ ./start-dpat.sh\n</code></pre> <p>Assim como detalhado na se\u00e7\u00e3o de Deployment do OWS Server, este script ir\u00e1 pedir ao usu\u00e1rio que informe os par\u00e2metros endere\u00e7o, nome, porta, usu\u00e1rio e senha do Banco de Dados, de forma a alterar corretamente o arquivo de configura\u00e7\u00e3o do ambiente, <code>.env</code> corretamente.</p> <p>Em seguida, ap\u00f3s pedir as informa\u00e7\u00f5es do Banco de Dados, o script ir\u00e1 pedir ao us\u00e1rio que informe o local onde a estrutura de pastas do Cerrado DPAT dever\u00e1 ser criada e tamb\u00e9m qual o endere\u00e7o de IP da m\u00e1quina de produ\u00e7\u00e3o onde ser\u00e1 realizado o deployment assim como informado nas imagens abaixo.</p> <p></p> <p></p> <p>Basicamente o script dever\u00e1 criar e ajustar automaticamente as vari\u00e1veis de ambiente do Cerrado DPAT, realizar o download e importa\u00e7\u00e3o do cont\u00e2iner docker onde todas as depend\u00eancias do projeto j\u00e1 est\u00e3o devidamente ajustadas e executar os passos necess\u00e1rios para compilar e disponibilizar a aplica\u00e7\u00e3o no endere\u00e7o de IP informado na execu\u00e7\u00e3o do script na porta 3000, assim como apresentado na imagem abaixo.</p>"},{"location":"02-arq_execucao_dpat/#script-completo-com-execucao-completa-para-producao","title":"Script completo com execu\u00e7\u00e3o completa para Produ\u00e7\u00e3o","text":"<p>Por fim, tamb\u00e9m foi criado um script que realiza todos os passos abordados nas se\u00e7\u00f5es Deployment do OWS Server e Deployment do Cerrado DPAT. Para tal, basta executar em Terminal.</p> <pre><code>$ ./start-dpat+ows.sh\n</code></pre> <p>Ap\u00f3s execu\u00e7\u00e3o dos scripts o OWS Server estar\u00e1 executando na m\u00e1quina do usu\u00e1rio na porta 5000 e o Cerrado DPAT tamb\u00e9m na m\u00e1quina do usu\u00e1rio na porta 3000.</p>"},{"location":"02-arq_geral/","title":"Arquitetura de software","text":"<p>O Cerrado DPAT foi desenvolvido de acordo com os padr\u00f5es de interoperabilidade definidos pela Open Geospatial Consortium (OGC) e a arquitetura de webservices com o padr\u00e3o REST.</p>"},{"location":"02-arq_geral/#componentes-de-software","title":"Componentes de software","text":"<p>A arquitetura de software desenvolvida para o Cerrado DPAT pode ser observada na Figura abaixo.</p> <p></p> <p>Essencialmente, pode-se dividir o Cerrado DPAT em tr\u00eas partes:</p> <ul> <li>Client: respons\u00e1vel por apresentar toda a interface, constru\u00eddo em Angular 8 com apoio dos frameworks:<ul> <li>WebMap: Mapa interativo constru\u00eddo com o OpenLayers</li> <li>Componentes front-end: Bootstrap 4, Material e PrimeNG.</li> </ul> </li> <li>Server: Disponibiliza os servi\u00e7os que comp\u00f5em a aplica\u00e7\u00e3o:<ul> <li>Application Server: Disponibiliza o acesso aos dados do Data Source, an\u00e1lises e configura\u00e7\u00f5es.</li> <li>OWS Server: Disponibiliza o acesso ao MapServer, respons\u00e1vel pelo processamento dos dados geogr\u00e1ficos, apresenta\u00e7\u00e3o visual dos mesmos e gerenciamento de cache das imagens geradas.</li> </ul> </li> <li>Data Source: Respons\u00e1vel por armazenar os dados vetoriais e matriciais.</li> </ul> <p>Resumidamente, todos os dados usados pelo Cerrado DPAT est\u00e3o organizados em um banco de dados PostgreSQL e em sistemas de arquivos (Data Repository). O PostgreSQL utiliza a extens\u00e3o PostGIS que permite processar consultas espaciais via Structured Query Language (SQL). J\u00e1 os dados que n\u00e3o necessitam de cruzamentos espaciais s\u00e3o armazenados em arquivos nos formatos Shapefile e/ou GeoTIFF.</p> <p>Estes dados s\u00e3o acessados pelo Application Server e pelo OWS Server (ambos constru\u00eddos em NodeJS) e s\u00e3o disponibilizados atrav\u00e9s de URLs com requisi\u00e7\u00f5es por meio do protocolo HTTP. Todas as requisi\u00e7\u00f5es Web realizadas aos Servers s\u00e3o interceptadas pelo Apache Server e devidamente redirecionadas. Desta forma, o Client realiza todas as requisi\u00e7\u00f5es necess\u00e1rias para construir a visualiza\u00e7\u00e3o dos elementos da p\u00e1gina, tais como: mapa interativo, gr\u00e1ficos, campo de busca e etc.</p> <p>Por fim, destaca-se que todo o c\u00f3digo-fonte para o Cerrado DPAT e tamb\u00e9m para o OWS Server foi disponibilizado publicamente no Github do LAPIG/UFG.</p>"},{"location":"02-arq_servidor_de_aplicacao/","title":"Servidor de Aplica\u00e7\u00e3o","text":"<p>Basicamente o Cerrado DPAT \u00e9 dividido em duas partes: o WebMap Client e o Application Server, conforme descrito anteriormente. O c\u00f3digo-fonte para estas duas partes est\u00e1 hospedado no resposit\u00f3rio Github do projeto.</p> <p>Dentro do reposit\u00f3rio do projeto, o c\u00f3digo-fonte do Application Server est\u00e1 em src/server. Por ser constru\u00eddo em NodeJS, ao clonar o projeto o usu\u00e1rio dever\u00e1 navegar at\u00e9 a pasta server e instalar as depend\u00eancias gerenciadas pelo Node Package Manager (NPM) atrav\u00e9s do comando:</p> <pre><code>npm install\n</code></pre> <p>Em seguida, deve-se copiar o arquivo .env.exemple renomeando-o para .env:</p> <pre><code>cp .env.exemple .env\n</code></pre> <p>Em seguida, deve-se alterar o arquivo .env com as devidas configura\u00e7\u00f5es e par\u00e2metros referentes ao banco de dados, pastas para armazenamento dos arquivos de Upload e Download e endere\u00e7o de hospedagem do OWS Server. Um exemplo de arquivo .env pode ser observado na se\u00e7\u00e3o</p> <p>Por fim, a fim de facilitar a execu\u00e7\u00e3o do Application Server foi desenvolvido um script nomeado <code>start.sh</code> localizado na raiz da pasta src/server. Portanto, basta realizar a execu\u00e7\u00e3o deste arquivo para inicializar o Application Server. A fim de identificar modifica\u00e7\u00f5es em tempo real, o Application Server faz uso da biblioteca <code>always</code>, portanto talvez seja necess\u00e1rio a instala\u00e7\u00e3o da mesma atrav\u00e9s do comando.</p> <pre><code>$ sudo npm install always -g\n</code></pre> <p>Ap\u00f3s a instala\u00e7\u00e3o do always, pode-se inicializar o Application Server atrav\u00e9s do comando:</p> <pre><code>$ ./src/server/start.sh\n</code></pre>"},{"location":"02-arq_servidor_de_aplicacao/#middleware-para-manipulacao-do-banco-de-dados","title":"Middleware para manipula\u00e7\u00e3o do banco de dados","text":"<p>Para facilitar a cria\u00e7\u00e3o de servi\u00e7os que fazem uso de consultas ao banco de dados foi criado um middleware nomeado <code>dataInjector.js</code> que cria um pool de conex\u00f5es para execu\u00e7\u00e3o de diversas queries simult\u00e2neas. </p> <p>O <code>dataInjector.js</code> analisa a URL da requisi\u00e7\u00e3o HTTP de modo a associar a fun\u00e7\u00e3o que especifica a query (por meio da tupla {id, sql}) com o controlador que ir\u00e1 devolver a resposta da requisi\u00e7\u00e3o.</p> <p>Portanto, todas as URLs dever\u00e3o ser criadas no seguinte padr\u00e3o:</p> <pre><code>'/service/&lt;nome_arquivo_js_com_query&gt;/&lt;nome_funcao_executada&gt;'\n</code></pre>"},{"location":"02-arq_servidor_de_aplicacao/#como-criar-um-novo-servico","title":"Como criar um novo servi\u00e7o","text":"<p>O Application Server possui tr\u00eas pastas que armazenam os principais arquivos que permitem a disponibiliza\u00e7\u00e3o de um novo servi\u00e7o ao Cerrado DPAT: </p> <ol> <li>Controller:: Os arquivos nesta pasta s\u00e3o respons\u00e1veis por processar implementar a l\u00f3gica da tarefa passada pela requisi\u00e7\u00e3o HTTP.</li> <li>Database: Os arquivos nesta pasta s\u00e3o respons\u00e1veis por implementar os m\u00e9todos com as queries a serem executadas no banco de dados. Devido a estrutura do <code>dataInjector.js</code>, mais de uma query poder\u00e1 ser executada durante uma mesma requisi\u00e7\u00e3o.</li> <li>Routes: Os arquivos desta pasta s\u00e3o os respons\u00e1veis por criar as URLs de acesso (endpoint) a um servi\u00e7o, apontar qual o controlador dever\u00e1 processar a l\u00f3gica para a requisi\u00e7\u00e3o e, caso necess\u00e1rio, injetar o acesso ao banco de dados.</li> </ol> <p>Portanto, supondo que queremos criar um novo servi\u00e7o para retornar os maiores desmatamentos em um determinado ano detectado pelo PRODES-Cerrado \u00e9 necess\u00e1rio criar/alterar os seguintes arquivos:</p> <pre><code>server/routes/example.js\n</code></pre> <p><code>js module.exports = function (app) {      var dataInjector = app.middleware.dataInjector     var example = app.controllers.examplecontroller;      app.get('/service/examplequery/largest', dataInjector, example.largest);  }</code> Ap\u00f3s a cria\u00e7\u00e3o do endpoint de acesso, basta criar o arquivo com as fun\u00e7\u00f5es desta classe de queries (<code>examplequery.js</code>) e a fun\u00e7\u00e3o (<code>Query.largest</code>) que ir\u00e1 executar a query especificada. Vale ressaltar que dever\u00e1 ser passado dois par\u00e2metros pela requisi\u00e7\u00e3o, o year e o amount, que indicam de qual ano e a quantidade de desmatamentos que o usu\u00e1rio quer encontrar.</p> <pre><code>server/database/queries/examplequery.js\n</code></pre> <p><code>js module.exports = function (app) {      var Query = {};      Query.largest = function (params) {      return [{             id: 'largest_id',             sql: \"SELECT view_date,county,uf, ST_ASGEOJSON(geom) FROM prodes_cerrado WHERE year = ${year} ORDER BY areamunkm DESC LIMIT ${amount}\"         }]     };      return Query; }</code> Ap\u00f3s a constru\u00e7\u00e3o do m\u00e9todo e a query, basta criar o controlador <code>examplecontroller.js</code> para receber a requisi\u00e7\u00e3o, realizar a chamada ao m\u00e9todo para execu\u00e7\u00e3o da query, coletar o resultado e enviar como resposta da requisi\u00e7\u00e3o.</p> <pre><code>server/controllers/examplecontroller.js\n</code></pre> <p><code>js module.exports = function (app) {      const config = app.config;      var Controller = {}      Controller.largest = function (request, response) {          var queryResult = request.queryResult['largest_id']          response.send(queryResult)         response.end()      }      return Controller; }</code></p> <p>Por fim, este por se tratar de uma requisi\u00e7\u00e3o HTTP do tipo <code>GET</code>, a mesma poder\u00e1 ser acessada via navegador. Considerando que o server est\u00e1 executando em <code>localhost:3000</code> e o usu\u00e1rio deseja encontrar os 15 maiores desmatamentos detectados pelo PRODES-Cerrado em 2019, a URL de acesso ficar\u00e1 da seguinte forma: </p> <pre><code>http://localhost:3000/service/examplequery/largest?year=2019&amp;amount=15\n</code></pre> <p>A visualiza\u00e7\u00e3o do JSON resultado da requisi\u00e7\u00e3o acima pode ser observado no link.</p> <p>Al\u00e9m de requisitar pelo navegador, o servi\u00e7o tamb\u00e9m poder\u00e1 ser requisitado pelo WebMap Client a fim de disponibilizar este dado na plataforma Cerrado DPAT. Para tal, o mesmo poder\u00e1 ser feito via biblioteca HttpClient do Angular e assim obter o arquivo JSON com os dados processados. Considerando que a vari\u00e1vel <code>http</code> foi devidadmente injetada no construtor da classe do Angular, o m\u00e9todo <code>getLargest()</code> abaixo dever\u00e1 realizar a requisi\u00e7\u00e3o e armazenar seu resultado na vari\u00e1vel <code>dados_largest</code>:</p> <pre><code>client/src/app/views/map.component.ts\n</code></pre> <p><code>js getLargest() {      let url = '/service/examplequery/largest?year=2019&amp;amount=15'      this.http.get(url).subscribe(r =&gt; {         this.dados_largest = r;     }); }</code></p>"},{"location":"02-arq_servidor_de_mapas/","title":"Servidor de Mapas","text":"<p>O OWS Server \u00e9 respons\u00e1vel por encaminhar as requisi\u00e7\u00f5es ao Mapserver a fim de gerar a visualiza\u00e7\u00e3o dos dados geogr\u00e1ficos e organizar para que as imagens geradas sejam armazenadas em cache para melhorar o desempenho em requisi\u00e7\u00f5es futuras. O c\u00f3digo-fonte para o OWS Server se encontra no reposit\u00f3rio Github do LAPIG/UFG.</p> <p></p> <p>Devido a facilidade em lidar com a arquitetura de WebServices, o c\u00f3digo em NodeJS foi criado para tamb\u00e9m realizar o controle de cache das imagens processadas pelo Mapserver. Para tal, uma customiza\u00e7\u00e3o foi criada a fim de se associar uma chave (<code>cacheKey</code>) a cada imagem de cada camada configurada no Mapserver. Esta imagem \u00e9 armazenada em um sistema de arquivos (pasta) chamada <code>OWS-Cache</code>, de modo que, em futuras requisi\u00e7\u00f5es para uma determinada imagem, \u00e9 verificada se a imagem j\u00e1 existe na <code>OWS-Cache</code> ou n\u00e3o. Caso exista, a imagem \u00e9 retornada na requisi\u00e7\u00e3o, caso n\u00e3o exista, o c\u00f3digo NodeJS envia a requisi\u00e7\u00e3o para o Mapserver processar e ger\u00e1-la, armazenando-a no <code>OWS-Cache</code>. O m\u00e9todo que realiza esta verifica\u00e7\u00e3o \u00e9 o m\u00e9todo <code>OgcServer.ows</code> que faz parte do Controlador da aplica\u00e7\u00e3o em NodeJS.</p> <pre><code>src/controllers/ogc-server.js\n</code></pre> <p><code>js OgcServer.ows = function(request, response) {     var params = Internal.getParams(request);     response.setHeader(\"Access-Control-Allow-Origin\", \"*\");      Internal.setHeaders(params, request, response);         var cacheKey = Internal.getCacheKey(params);          if(cacheKey &amp;&amp; (config['cacheEnable'] || Internal.isWmsGetCap(params)) ) {             Internal.doRequestWithCache(cacheKey, params, response);         } else {             Internal.doRequest(params, response);         } }</code> Esta customiza\u00e7\u00e3o pode ser encontrada no c\u00f3digo NodeJS no reposit\u00f3rio espec\u00edfico para o c\u00f3digo NodeJS no Github. A configura\u00e7\u00e3o da pasta onde ser\u00e3o gerados os caches \u00e9 feita no arquivo config.js na linha 41 atrav\u00e9s da vari\u00e1vel <code>cacheDir</code>.</p>"},{"location":"02-arq_servidor_de_mapas/#servico-de-interoperabilidade","title":"Servi\u00e7o de interoperabilidade","text":"<p>A interoperabilidade \u00e9 uma tecnologia que possibilita o compartilhamento de dados entre sistemas, independente do local f\u00edsico de armazenamento e da tecnologia utilizada em cada servidor de dados. No Geoprocessamento, a interoperabilidade pode ser aplicada para promover o interc\u00e2mbio de dados geogr\u00e1ficos entre diferentes softwares de SIG. O OCG (Open Geospatial Consortium, Inc.) \u00e9 uma organiza\u00e7\u00e3o que tem como objetivo principal viabilizar o interc\u00e2mbio de dados geogr\u00e1ficos atrav\u00e9s da cria\u00e7\u00e3o de especifica\u00e7\u00f5es que simplificam a intera\u00e7\u00e3o entre diferentes fontes de dados. Desta forma, os principais servi\u00e7os especificados pela OGC s\u00e3o:</p> <ul> <li>Web Map Service - WMS: produz mapas din\u00e2micos partir de dados georreferenciados em um servidor remoto. Esses mapas s\u00e3o geralmente apresentados no formato de figura (PNG, JPEG ou GIF). Tamb\u00e9m \u00e9 poss\u00edvel consultar os atributos dos elementos que comp\u00f5em os mapas. </li> <li>Web Feature Service - WFS: define um servi\u00e7o para recupera\u00e7\u00e3o de objetos (features) espaciais. Diferentemente do WMS, o WFS devolve o dado e n\u00e3o uma \"figura\" do dado. </li> <li>Tile Map Service - TMS: define um servi\u00e7o que fornece imagens de dados geogr\u00e1ficos a partir de URLs para por\u00e7\u00f5es (tiles) definidas pelo conjunto de coordenadas {z} {x} {y} do dado georeferenciado. O TMS \u00e9 mais amplamente suportado pelos navegadores Web. <ul> <li>UTFGrid: usam uma combina\u00e7\u00e3o de codifica\u00e7\u00e3o JSON e arquivos grid ASCII que est\u00e3o ao lado de cada bloco de imagem do mapa. Desta forma, uma tabela de pesquisa em JSON fornece o conjunto completo de atributos que viabiliza a devolu\u00e7\u00e3o de dados sobre aquele grid, permitindo interatividade com o mapas.</li> </ul> </li> </ul> <p>Desta forma, uma representa\u00e7\u00e3o visual da interoperabilidade entre servi\u00e7os pode ser encontrada no link e apresentada abaixo.</p> <p></p> <p>Por fim, a tabela abaixo apresenta os tipos de servi\u00e7os fornecidos pelo Cerrado DPAT bem como suas URLs de acesso, onde <code>&lt;ows_host&gt;</code> representa o dom\u00ednio onde o OWS Server est\u00e1 hospedado e <code>&lt;layername&gt;</code> representa a camada configurada no Mapfile:</p> Tipo de Requisi\u00e7\u00e3o Fonte Descri\u00e7\u00e3o URL WMS OWS Server Retorna uma imagem com a legenda da camada (<code>&lt;layername&gt;</code>) especificada no mapfile.. <code>https://&lt;ows_host&gt;/ows?TRANSPARENT=TRUE&amp;VERSION=1.1.1&amp;SERVICE=WMS&amp;REQUEST=GetLegendGraphic&amp;layer=&lt;layername&gt;&amp;format=image/png</code> WMS OWS Server Retorna uma imagem com a composi\u00e7\u00e3o de camadas identificadas pelas layers, com o foco no enquadramento para a geometria definida pela fun\u00e7\u00e3o ST_EXTENT do Postgis. Por fim, o par\u00e2metro <code>&lt;sql_applied_on_MSFILTER&gt;</code> especifica a query que dever\u00e1 ser aplicada para filtrar dados em todas as camadas que possuam <code>MSFILTER</code> em sua configura\u00e7\u00e3o no Mapserver. <code>https://&lt;ows_host&gt;/ows?SERVICE=WMS&amp;REQUEST=GetMap&amp;VERSION=1.1.1&amp;layers=&lt;layername1&gt;,&lt;layername2&gt;, ... &amp;bbox=&lt;bounding_box&gt;&amp;TRANSPARENT=TRUE&amp;srs=EPSG:4674&amp;width=768&amp;height=768&amp;format=image/png&amp;styles=&amp;ENHANCE=TRUE&amp;MSFILTER=&lt;sql_applied_on_MSFILTER&gt;</code> TMS OWS Server Retorna uma imagem com a composi\u00e7\u00e3o de camadas identificadas pelas layers, com o foco no enquadramento para a geometria definida pela fun\u00e7\u00e3o ST_EXTENT do Postgis. Por fim, o par\u00e2metro <code>&lt;sql_applied_on_MSFILTER&gt;</code> especifica a query que dever\u00e1 ser aplicada para filtrar dados em todas as camadas que possuam <code>MSFILTER</code> em sua configura\u00e7\u00e3o no Mapserver. <code>https://&lt;ows_host&gt;/ows?layers=&lt;layername&gt;&amp;MSFILTER=&lt;sql_applied_on_MSFILTER&gt;&amp;mode=tile&amp;tile=&lt;{z}&gt;+&lt;{x}&gt;+&lt;{y}&gt;&amp;tilemode=gmap&amp;map.imagetype=png</code> TMS Mapbox Retorna a composi\u00e7\u00e3o do mapa Geopol\u00edtico fornecido pela Mapbox <code>https://api.tiles.mapbox.com/v4/mapbox.light/&lt;{z}&gt;/&lt;{x}&gt;/&lt;{y}&gt;.png?access_token=&lt;chave_de_acesso&gt;.</code> TMS Google Maps Retorna a composi\u00e7\u00e3o de imagens do mapa fornecido pela API do GoogleMaps. <code>https://mt{0-3}.google.com/vt/lyrs=m&amp;x=&lt;{x}&gt;&amp;y=&lt;{y}&gt;&amp;z=&lt;{z}&gt;</code> TMS World Shaded Relief Retorna a composi\u00e7\u00e3o de mapas de Relevo fornecido pelo ArcGis. <code>https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/&lt;{z}&gt;/&lt;{y}&gt;/&lt;{x}&gt;</code> UTFGrid OWS Server Retorna os dados referentes aos atributos definidos na camada fornecida pelo OWS Server para o  especificado na requisi\u00e7\u00e3o para o tile {z},{x},{y}. <code>https://&lt;ows_host&gt;/ows?layers=&lt;layername&gt;&amp;MSFILTER=&lt;sql_applied_on_MSFILTER&gt;&amp;mode=tile&amp;tile=&lt;{z}&gt;+&lt;{x}&gt;+&lt;{y}&gt;&amp;tilemode=gmap&amp;map.imagetype=utfgrid</code>"},{"location":"02-arq_servidor_de_mapas/#processo-de-atualizacao","title":"Processo de atualiza\u00e7\u00e3o","text":"<p>Um dado geogr\u00e1fico \u00e9 disponbilizado pelo Mapserver como uma camada. Assim como abordado na se\u00e7\u00e3o de servi\u00e7os de interoperabilidade os dados devem estar armazenados em uma pasta de cat\u00e1logo dos dados (pasta catalog) configur\u00e1vel no arquivo config.js atrav\u00e9s da vari\u00e1vel <code>cacheDir</code>.</p> <p>O Mapserver utiliza um arquivo de configura\u00e7\u00e3o para renderiza\u00e7\u00e3o de dados geoespaciais chamado de Mapfile. O principal objetivo do Mapfile \u00e9 definir as camadas que podem ser \"desenhadas\" pelo Mapserver, como ler estes dados (uma vez que eles podem ser vetores ou matrizes) e como renderiz\u00e1-los, definindo cores, s\u00edmbolos, r\u00f3tulos, legendas e etc. Desta forma, o Mapfile inclui informa\u00e7\u00f5es sobre:</p> <ul> <li>Quais camadas devem ser renderizadas;</li> <li>Onde est\u00e1 o foco geogr\u00e1fico do mapa;</li> <li>Qual proje\u00e7\u00e3o est\u00e1 sendo usada;</li> <li>Qual o formato gr\u00e1fico de sa\u00edda;</li> <li>Configura\u00e7\u00e3o da legenda e a escala utilizada;</li> </ul> <p>A figura abaixo apresenta o Mapfile da camada dos desmatamentos PRODES-Cerrado presente no Cerrado DPAT. Esta mesma figura pode representar um exemplo pr\u00e1tico para cria\u00e7\u00e3o de um Mapfile com conex\u00e3o com Banco de Dados e assim obter dados em formato vetorial. Portanto, segue a especifica\u00e7\u00e3o de cada item destacado na imagem:</p> <p></p> <ol> <li> <p>Apresenta o nome da camada, bem como a fonte de onde este dado ser\u00e1 carregado. No exemplo este dado \u00e9 acessado pela comunica\u00e7\u00e3o com Postgis devidamente autenticado;</p> </li> <li> <p>Determina o foco do dado para a extens\u00e3o do Cerrado;</p> </li> <li> <p>Apresenta os metadados da camada;</p> </li> <li> <p>Cria uma vari\u00e1vel para valida\u00e7\u00e3o e filtragem dos dados por meio do runtime substitution;</p> </li> <li> <p>Define a proje\u00e7\u00e3o do dado apresentado;</p> </li> <li> <p>Define o tipo do dado apresentado;</p> </li> <li> <p>Define a estrutura dos dados que s\u00e3o enviados via UTFGrid. Para tal \u00e9 importante definir um identificador \u00fanico (UTFITEM) e os dados a serem enviados atrav\u00e9s da tupla {\"chave_acesso\" : \"coluna_banco_dados\"} em UTFDATA que ir\u00e3o compor o JSON gerado.</p> </li> <li> <p>Define uma classifica\u00e7\u00e3o para os dados a fim de customizar a colora\u00e7\u00e3o de acordo com um crit\u00e9rio. A classifica\u00e7\u00e3o estabelecida tamb\u00e9m ir\u00e1 compor a legenda.</p> </li> </ol> <p>Um segundo tipo de camada de dados presente no Cerrado DPAT \u00e9 oriundo de dados matriciais, ou seja, imagens TIF. Portanto, para cria\u00e7\u00e3o de um Mapfile para um TIF \u00e9 necess\u00e1rio alterar as sess\u00f5es (1) - onde deve-se apresentar a localiza\u00e7\u00e3o do arquivo TIF no sistema de arquivos atrav\u00e9s da diretiva 'DATA'; (6) - alterar para o tipo de dados Raster e (8), onde o crit\u00e9rio para classifica\u00e7\u00e3o se d\u00e1 de acordo com o valor do pixel em um ponto. Portanto, o Mapfile para arquivos matriciais se d\u00e1 conforme imagem abaixo.</p> <p></p> <p>Por fim, o Mapfile utilizado para disponibilizar todas as camadas presentes no Cerrado DPAT est\u00e1 na pasta compartilhada do projeto no link.</p>"},{"location":"02-arq_servidor_de_mapas/#disponibilizacao-da-camada-no-application-server","title":"Disponibiliza\u00e7\u00e3o da camada no Application Server","text":"<p>Ap\u00f3s a cria\u00e7\u00e3o da camada no OWS Server, para que esta camada seja apresentada na interface Web do Cerrado DPAT \u00e9 necess\u00e1ria a sua inser\u00e7\u00e3o no Application Server. A fim de facilitar a disponibiliza\u00e7\u00e3o de diversas camadas, foi criada uma estrutura nomeada de <code>descriptor</code> que descreve as principais configura\u00e7\u00f5es de uma camada a ser apresentada no Cerrado DPAT, tais como: filtros de dados, tipos diferentes de camadas e outros. A estrutura completa do descriptor encontra-se no reposit\u00f3rio do projeto no Github, especificamente no arquivo map.js.</p> <p>Segue abaixo as configura\u00e7\u00f5es das camadas apresentadas acima dentro da estrutura do descriptor. Primeiramente, iremos disponibilizar a camada <code>bi_ce_prodes_desmatamento_100_fip</code> que representa um dado vetorial no qual \u00e9 poss\u00edvel aplicar diversos filtros. A vari\u00e1vel <code>languageJson</code> representa o acesso ao arquivo .json respons\u00e1vel pela internacionaliza\u00e7\u00e3o da aplica\u00e7\u00e3o, ou seja, apresenta textos em diferentes idiomas de acordo com o valor recebido como par\u00e2metro <code>language</code>.  </p> <pre><code>Controller.descriptor = function (request, response) {\nvar language = request.param('lang')\nvar result = {\nregionFilterDefault: \"\",\ntype: languageJson[\"descriptor\"][\"type_of_information_label\"][language],\ngroups: [{\nid: \"desmatamento\",\nlabel: languageJson[\"descriptor\"][\"desmatamento\"][\"label\"][language],\ngroup_expanded: true,\nlayers: [{\nid: \"desmatamento_prodes\",\nlabel: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"desmatamento_prodes\"][\"label\"][language],\nvisible: true,\nselectedType: \"bi_ce_prodes_desmatamento_100_fip\",\nmetadata: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"desmatamento_prodes\"]['metadata'],\ntypes: [\n{\nvalue: \"bi_ce_prodes_desmatamento_100_fip\",\nViewvalue: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"desmatamento_prodes\"][\"types\"][\"bi_ce_prodes_desmatamento_100_fip\"][\"view_value\"][language],\nopacity: 1,\norder: 1,\ndownload: ['csv', 'shp'],\nregionFilter: true,\ntimeLabel: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"desmatamento_prodes\"][\"types\"][\"bi_ce_prodes_desmatamento_100_fip\"][\"timelabel\"][language],\ntimeSelected: \"year=2019\",\ntimeHandler: \"msfilter\",\ntimes: [{\nvalue: \"year=2002\",\nViewvalue: \"2000/2002\",\nyear: 2002\n},\n{\nvalue: \"year=2004\",\nViewvalue: \"2002/2004\",\nyear: 2004\n},\n{\nvalue: \"year=2006\",\nViewvalue: \"2004/2006\",\nyear: 2006\n},\n{\nvalue: \"year=2008\",\nViewvalue: \"2006/2008\",\nyear: 2008\n},\n{\nvalue: \"year=2010\",\nViewvalue: \"2008/2010\",\nyear: 2010\n},\n{\nvalue: \"year=2012\",\nViewvalue: \"2010/2012\",\nyear: 2012\n},\n{\nvalue: \"year=2013\",\nViewvalue: \"2012/2013\",\nyear: 2013\n},\n{\nvalue: \"year=2014\",\nViewvalue: \"2013/2014\",\nyear: 2014\n},\n{\nvalue: \"year=2015\",\nViewvalue: \"2014/2015\",\nyear: 2015\n},\n{\nvalue: \"year=2016\",\nViewvalue: \"2015/2016\",\nyear: 2016\n},\n{\nvalue: \"year=2017\",\nViewvalue: \"2016/2017\",\nyear: 2017\n},\n{\nvalue: \"year=2018\",\nViewvalue: \"2017/2018\",\nyear: 2018\n},\n{\nvalue: \"year=2019\",\nViewvalue: \"2018/2019\",\nyear: 2019\n}\n}]\n},\n{\nid: \"susceptibilidade\",\nlabel: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"susceptibilidade\"][\"label\"][language],\nvisible: false,\nselectedType: \"bi_ce_susceptibilidade_desmatamento_menores_100_na_lapig\",\nmetadata: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"susceptibilidade\"]['metadata'],\ntypes: [{\nvalue: \"bi_ce_susceptibilidade_desmatamento_menores_100_na_lapig\",\nViewvalue: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"susceptibilidade\"][\"types\"][\"bi_ce_susceptibilidade_desmatamento_menores_100_na_lapig\"][\"view_value\"][language],\norder: 5,\ndownload: ['tif'],\nopacity: 1\n},\n{\nvalue: \"bi_ce_susceptibilidade_desmatamento_maiores_100_na_lapig\",\nViewvalue: languageJson[\"descriptor\"][\"desmatamento\"][\"layers\"][\"susceptibilidade\"][\"types\"][\"bi_ce_susceptibilidade_desmatamento_maiores_100_na_lapig\"][\"view_value\"][language],\norder: 5,\ndownload: ['tif'],\nopacity: 1\n}\n]\n}\n}]\n}]\n};\nresponse.send(result);\nresponse.end();\n};\n</code></pre> <p>Os diversos par\u00e2metros setados na vari\u00e1vel <code>result</code> s\u00e3o interpretados pela aplica\u00e7\u00e3o Front-end em Angular, de modo a criar a interface apresentada na imagem abaixo. Dentre estes par\u00e2metros, destaca-se o <code>layers</code> que ir\u00e3o indicar quais camadas estar\u00e3o no card Desmatamento PRODES-Cerrado. No exemplo acima, est\u00e1 selecionada a camada <code>bi_ce_prodes_desmatamento_100_fip</code> atrav\u00e9s da vari\u00e1vel selectedType, e logo abaixo apresenta-se o vetor <code>types</code> que apresenta os tipos de camadas PRODES-Cerrado est\u00e3o dispon\u00edveis. Por fim, destaca-se o vetor do par\u00e2metro <code>times</code>, que apresenta diversos filtros que podem ser aplicados em um tipo de layer espec\u00edfico. No exemplo acima, ele \u00e9 utilizado para filtrar os pol\u00edgonos por ano, aplicando a query apresentada em <code>value</code> (de cada filtro) como par\u00e2metro MSFILTER na camada descrita no Mapserver.</p> <p></p> <p>Por fim, o segundo exemplo apresenta a disponibiliza\u00e7\u00e3o da camada <code>bi_ce_susceptibilidade_desmatamento_menores_100_na_lapig</code> criada acima a partir de uma imagem Raster no formato TIF. O grande diferencial desta \u00e9 a impossibilidade de aplicar quaisquer filtro na imagem por se tratar de um dado matricial est\u00e1tico, logo o par\u00e2metro <code>times</code> n\u00e3o \u00e9 utilizado. Portanto, de acordo com a imagem abaixo, que apresenta a estrutura criada no Front-end para esta representa\u00e7\u00e3o no descriptor.</p> <p></p>"},{"location":"03-dad_rasters/","title":"Dados Rasters","text":"<p>Os dados Rasters s\u00e3o imagens com informa\u00e7\u00f5es geogr\u00e1ficas e est\u00e3o armazenados no sistema de arquivos do servidor. A configura\u00e7\u00e3o da pasta do local de armazenamento destes arquivos \u00e9 feita no OWS Server na linha 54 do arquivo config.js, atrav\u00e9s da vari\u00e1vel <code>config['path_catalog']</code>. Esta configura\u00e7\u00e3o dever\u00e1 apresentar a pasta com o cat\u00e1logo de dados a serem disponibilizados no OWS Server.</p>"},{"location":"03-dad_rasters/#estrutura-de-diretorios","title":"Estrutura de diret\u00f3rios","text":"<p>Todos os dados geogr\u00e1ficos Raster do projeto podem ser encontrados no link.</p> <p>Ap\u00f3s a descompacta\u00e7\u00e3o do arquivo <code>DADOS_RASTER_CATALOG_FIP_CERRADO.tar.gz</code> os dados est\u00e3o armazenados em diferentes subpastas. Considerando os dados catalogados na se\u00e7\u00e3o Dados Geogr\u00e1ficos e o diret\u00f3rio configurado no <code>config.js</code> temos os seguintes dados em formato raster:</p> Dado Nome do arquivo Subpasta Susceptibilidade a Desmatamentos Grandes bi_ce_susceptibilidade_desmatamento_maiores_100_na_lapig.tif /FIP Susceptibilidade a Desmatamentos Pequenos bi_ce_susceptibilidade_desmatamento_menores_100_na_lapig.tif /FIP Altitude bi_ce_srtm_altitude_30_2000_lapig.tif /Relevo Declividade bi_ce_srtm_declividade_30_2000_lapig.tif /Relevo M\u00e9dia da Precipita\u00e7\u00e3o Acumulada bi_ce_precipitacao_historica_30_lapig.tif /\u00c1gua Mosaico Landsat 2000-2019 bi_ce_mosaico_landsat_completo_30_2000_fip.tif  bi_ce_mosaico_landsat_completo_30_2002_fip.tif  bi_ce_mosaico_landsat_completo_30_2004_fip.tif    bi_ce_mosaico_landsat_completo_30_2006_fip.tif    bi_ce_mosaico_landsat_completo_30_2008_fip.tif  bi_ce_mosaico_landsat_completo_30_2010_fip.tif  bi_ce_mosaico_landsat_completo_30_2012_fip.tif  bi_ce_mosaico_landsat_completo_30_2013_fip.tif  bi_ce_mosaico_landsat_completo_30_2014_fip.tif  bi_ce_mosaico_landsat_completo_30_2015_fip.tif  bi_ce_mosaico_landsat_completo_30_2016_fip.tif  bi_ce_mosaico_landsat_completo_30_2017_fip.tif  bi_ce_mosaico_landsat_completo_30_2018_fip.tif  bi_ce_mosaico_landsat_completo_30_2019_fip.tif  /img_satelites/bi_ce_mosaico_landsat_30_fip Mosaico Sentinel 2016-2019 bi_ce_mosaico_sentinel_10_2016_lapig.tif  bi_ce_mosaico_sentinel_10_2017_lapig.tif  bi_ce_mosaico_sentinel_10_2018_lapig.tif  bi_ce_mosaico_sentinel_10_2019_lapig.tif /img_satelites/bi_ce_mosaico_sentinel_10_lapig"},{"location":"03-dad_rasters/#processo-de-atualizacao","title":"Processo de atualiza\u00e7\u00e3o","text":""},{"location":"03-dad_rasters/#mosaicos-landsat","title":"Mosaicos Landsat","text":"<p>Os mosaicos Landsat disponibilizados para visualiza\u00e7\u00e3o no Cerrado DPAT s\u00e3o os mesmos utilizados pelo INPE para inspe\u00e7\u00e3o visual e detec\u00e7\u00e3o das \u00e1reas desmatadas pelo sistema PRODES-Cerrado. Tais imagens podem ser baixadas pelo portal Earth Explorer de acordo com a data e a \u00f3rbita-ponto presentes no arqivo shapefile disponibilizado pelo INPE no portal Terrabrasilis. Ap\u00f3s o download do arquivo compactado correspondente a cada imagem, devem ser criadas composi\u00e7\u00f5es multibandas com as bandas do vermelho, infravermelho, e infravermelho de ondas curtas. Uma outra forma mais simples para a obten\u00e7\u00e3o destas imagens \u00e9 o contato direto com a equipe do LAPIG atrav\u00e9s do e-mail cerradodpat.lapig@ufg.br.</p> <p>Com as imagens devidamente armazenadas, dois scripts correspondentes ao recorte do limite util da cena e a cria\u00e7\u00e3o do mosaico das imagens de cada ano s\u00e3o executados simultaneamente por meio da execu\u00e7\u00e3o do arquivo run.sh , que ir\u00e1 chamar o arquivo clip_landsat.sh. No arquivo run.shp \u00e9 necess\u00e1rio que se edite as seguintes linhas:</p> <p><code>INPUT_DIR=\"\"</code> Diret\u00f3rio \"raiz\" para as cenas isoladas de cada ano (linha 3). <code>OUTPUT_DIR=\"\"</code> Diret\u00f3rio de sa\u00edda com os mosaicos de cada ano (linha 4). <code>DIRS=\"\"</code> Diret\u00f3rios com os anos a serem mosaicados. (linha 5)  </p> <p>No arquivo clip_landsat.sh, a edi\u00e7\u00e3o \u00e9 feita na seguinte linha:</p> <p><code>INPUT_GRID=\"\"</code> Arquivo no formato shapefile com os limites das cenas Landsat. (linha 10)</p> <p>Ap\u00f3s as edi\u00e7\u00f5es deve-se executar o seguinte comando:</p> <pre><code>sh run.sh\n</code></pre> <p>As imagens no formato TIF de cada ano estar\u00e3o disponiveis na pasta apontada em <code>OUTPUT_DIR</code>. </p>"},{"location":"03-dad_rasters/#mosaicos-sentinel-2","title":"Mosaicos Sentinel-2","text":"<p>As imagens Sentinel-2 foram baixadas por meio da plataforma Google Earth Engine. Devido a caracteristica sazonal do bioma Cerrado, um mesmo alvo pode apresentar diferentes respostas espectrais durante os diferentes meses do ano. Assim, para que o mosaico apresentasse um padr\u00e3o mais homog\u00eaneo entre as cenas, buscou-se por imagens dentro de um curto periodo de tempo. Foram priorizadas imagens para o periodo de um m\u00eas. No caso da indisponibilidade de imagens sem nuvens, o periodo foi estendido at\u00e9 que o intervalo entre maio e outubro fosse alcan\u00e7ado. Destaca-se tamb\u00e9m que diferentes padr\u00f5es clim\u00e1ticos podem ser encontrado no bioma, dificultando assim a identifica\u00e7\u00e3o de imagens sem nuvens. Dessa forma, diferentes geometrias foram criadas para a sele\u00e7\u00e3o de imagens em regi\u00f5es espec\u00edficas (ex: norte do bioma, pr\u00f3ximo ao litoral maranhense). O c\u00f3digo para o download do mosaico Sentinel-2 encontra-se disponivel para acesso.</p> <p>Devido ao limite de tamanho o mosaico baixado \u00e9 dividido em tiles. A jun\u00e7\u00e3o dos tiles em um \u00fanico arquivo \u00e9 feita a partir dos comandos gdalbuildvrt e gdal_translate presentes no pacote GDAL.</p> <pre><code>gdalbuildvrt mosaic_\"$ano\".vrt mosaic_\"$ano\"* -srcnodata 0 -vrtnodata 0\n\ngdal_translate mosaic_\"$ano\".vrt mosaic_\"$ano\".tif -co COMPRESS=LZW -co BIGTIFF=YES -co TILED=YES -a_nodata 0\n</code></pre> <p>Onde <code>$ano</code> \u00e9 o ano de cada mosaico, presente no nome dos tiles correspondentes a imagem baixada.</p>"},{"location":"03-dad_rasters/#disponibilizacao-no-ows-server","title":"Disponibiliza\u00e7\u00e3o no OWS Server","text":"<p>Ap\u00f3s a cria\u00e7\u00e3o dos arquivos \u00fanicos para os mosaicos Landsat e Sentinel, antes de disponibilizar o mosaico ao OWS Server \u00e9 necess\u00e1rio a cria\u00e7\u00e3o das pir\u00e2mides para n\u00edveis diferentes de visualiza\u00e7\u00e3o do mosaico. Para criar a visualiza\u00e7\u00e3o em n\u00edveis, execute o comando:</p> <pre><code>gdaladdo --config USE_RRD=YES -ro &lt;nome_arquivo.tif&gt; 2 4 8\n</code></pre> <p>Ao finalizar o processamento, \u00e9 importante definir o valor das bandas para a colora\u00e7\u00e3o do mosaico, o que pode ser alcan\u00e7ado com o apoio do QGIS, ao clicar com o bot\u00e3o direito sobre a camada -&gt; propriedades -&gt; simbologia na op\u00e7\u00e3o.A imagem abaixo apresenta um exemplo de defini\u00e7\u00e3o do valor das bandas aplicadas ao mosaico Sentinel de 2018.</p> <p></p> <p>Por fim, pode-se ent\u00e3o disponibilizar o mosaico como camada no Mapserver atrav\u00e9s de um mapfile. Um exemplo de mapfile para cria\u00e7\u00e3o da camada com o mosaico Sentinel de 2018 pode ser visualizada abaixo:</p> <pre><code>LAYER\n  NAME \"bi_ce_mosaico_sentinel_10_2018_lapig\"\n  DATA \"img_satelites/bi_ce_mosaico_sentinel_10_lapig/bi_ce_mosaico_sentinel_10_2018_lapig.tif\"\n  EXTENT -60.1094198 -24.6846260 -41.5220189 -2.3262773\n  METADATA\n    \"ows_title\" \"Mosaico Sentinel do Bioma Cerrado\"\n    \"ows_abstract\" \"A gera\u00e7\u00e3o dos mosaicos considerou, para cada cena e ano, a melhor imagem (i.e. com a menor cobertura de nuvens) adquirida no per\u00edodo de junho \u00e0 setembro.\"\n    \"gml_exclude_items\" \"the_geom\"\n    \"gml_include_items\" \"all\"\n    \"gml_geometries\"  \"the_geom\"\n  END\n  PROJECTION\n    \"init=epsg:4674\"\n  END\n  STATUS ON\n  TYPE Raster\n  TEMPLATE \"DUMMY\"\n  OFFSITE 0 0 0\n  PROCESSING \"SCALE_1=748,1405\"\n  PROCESSING \"SCALE_2=613,1534\"\n  PROCESSING \"SCALE_3=385,2134\"\n  PROCESSING \"BANDS=3,2,1\"\nEND\n</code></pre> <p>\u00c9 importante ressaltar a inser\u00e7\u00e3o do par\u00e2metro <code>PROCESSING \"SCALE_\"</code> ao Mapfile permitindo informar ao Mapserver os valores de bandas definidos anteriormente.</p>"},{"location":"03-dad_vetoriais/","title":"Dados Vetoriais","text":"<p>No Cerrado DPAT todos os dados vetoriais est\u00e3o armazenados em um banco de dados PostgreSQL. O \u00faltimo backup deste banco pode ser encontrado no link no arquivo <code>BKP_BANCO_DADOS_FIP_CERRADO.tar.gz</code>. </p>"},{"location":"03-dad_vetoriais/#banco-de-dados-e-mer","title":"Banco de dados e MER","text":"<p>No modelo de entidade relacionamento (MER) do banco de dados, apresentado a seguir, as tabelas foram agrupadas em duas categorias:</p> <ul> <li> <p>Entidades Principais (cinza): estrutura respons\u00e1vel por armazenar os dados consolidados utilizados no Cerado DPAT, conforme foram disponibilizados pela sua institui\u00e7\u00e3o. O Cerrado DPAT conta com mais de 20 entidades, por\u00e9m, em sua maioria s\u00e3o utilizados apenas como camadas de dados, sem realiza\u00e7\u00e3o de cruzamentos, portanto, as entidades utilizadas neste MER foram as utilizadas em diversos cruzamentos espaciais para an\u00e1lise.</p> </li> <li> <p>Tabelas com cruzamentos espaciais: estrutura respons\u00e1vel por armazenar resultados de cruzamentos espaciais entre diferentes entidades do Cerrado DPAT. Em sua maioria, os cruzamentos espaciais resultam em refer\u00eancias entre chaves \u00fanicas, al\u00e9m do resultado de algum tipo de processamento, como por exemplo, area_desmat, que representa a \u00e1rea desmatada (detectada pelo PRODES-Cerrado) em uma propriedade rural, que \u00e9 armazenada pela tabela car_desmat.</p> </li> </ul> <p></p>"},{"location":"03-dad_vetoriais/#principais-entidades","title":"Principais entidades","text":""},{"location":"03-dad_vetoriais/#prodes_cerrado-e-deter_cerrado","title":"prodes_cerrado e deter_cerrado","text":"<p>Entidades (tabelas) respons\u00e1veis por armazenar os pol\u00edgonos PRODES-Cerrado e DETER-Cerrado consolidados que s\u00e3o apresentados no Cerrado DPAT. O identificador \u00fanico (gid) destas tabelas s\u00e3o usadas em entidades auxiliares, tais como, pontos_campo, validacao_amostral, car_desmat e outras para identificar seu cruzamento com as mesmas, portanto, n\u00e3o se deve alter\u00e1-lo.</p>"},{"location":"03-dad_vetoriais/#regions","title":"regions","text":"<p>Entidade respons\u00e1vel por armazenar todas as regi\u00f5es (munic\u00edpios e estados) do Cerrado. A coluna <code>value</code> apresenta o valor de identifica\u00e7\u00e3o da regi\u00e3o e <code>type</code> diferencia munic\u00edpios (anotado como city) dos estados (anotado como state).</p>"},{"location":"03-dad_vetoriais/#car_cerrado","title":"car_cerrado","text":"<p>Entidade respons\u00e1vel por armazenar os dados de cada propriedade rural presente no Cerrado. Cada propriedade possui um identificador \u00fanico anotado pela vari\u00e1vel <code>idt_imovel</code>. Este valor \u00e9 utilizado para associar cada propriedade rural com a reserva legal (tabela <code>geo_car_reserva_legal_cerrado</code>), com \u00e1reas de preserva\u00e7\u00e3o permanente (tabela <code>geo_car_app_cerrado</code>) e nascentes (tabela <code>geo_car_nascente_cerrado</code>).</p>"},{"location":"03-dad_vetoriais/#processo-de-atualizacao","title":"Processo de atualiza\u00e7\u00e3o","text":"<p>Diversos dados presentes na plataforma Cerrado DPAT s\u00e3o periodicamente atualizados pelas institui\u00e7\u00f5es competentes. Desta forma, a medida que os mesmos s\u00e3o atualizados e disponibilizados pelas institui\u00e7\u00f5es tamb\u00e9m \u00e9 necess\u00e1rio realizar a atualiza\u00e7\u00e3o no banco de dados do Cerrado DPAT.</p> <p>Os comandos a seguir foram todos desenvolvidos na linguagem <code>sql</code>, portanto podem ser executados em qualquer ambiente que realize a conex\u00e3o com PostgreSQL, tais como o pgAdmin ou o pr\u00f3prio ambiente nativo conhecido como <code>psql</code>. A fim de facilitar, pode-se criar um arquivo de extens\u00e3o <code>.sql</code> e execut\u00e1-lo da seguinte forma:</p> <pre><code>psql \"dbname='&lt;db_name&gt;' user='&lt;db_user&gt;' password='&lt;db_pwd&gt;' host='&lt;db_host'\" -f &lt;path_to_&gt;/yourFileName.sql\n</code></pre>"},{"location":"03-dad_vetoriais/#prodes-cerrado","title":"PRODES Cerrado","text":"<p>Devido a divulga\u00e7\u00e3o anual do PRODES-Cerrado \u00e9 necess\u00e1rio realizar a sua atualiza\u00e7\u00e3o sempre que um novo produto \u00e9 lan\u00e7ado. Desta forma, deve-se visitar o site do Terrabrasilis para verificar se um novo PRODES-Cerrado foi lan\u00e7ado e realizar o seu download em Shapefile. </p> <p>A fim de demonstrar todos os procedimentos necess\u00e1rios ap\u00f3s uma nova atualiza\u00e7\u00e3o do PRODES-Cerrado, iremos utilizar o mesmo processo realizado na atualiza\u00e7\u00e3o do PRODES-Cerrado 2019 executada em Janeiro de 2020. Na ocasi\u00e3o o INPE disponibilizou um Shapefile \u00fanico para o PRODES-Cerrado 2019 com uma estrutura pr\u00f3pria detalhada a seguir. Atualmente, pode-se encontrar todos os desmatamentos PRODES-Cerrado em um Shapefile \u00fanico no link. Por\u00e9m \u00e9 importante ressaltar que o padr\u00e3o das colunas disponibilizados pelo INPE pode ser alterada em atualiza\u00e7\u00f5es futuras.</p> <p>Ap\u00f3s download do shapefile \u00fanico contendo os desmatamentos PRODES-Cerrado 2019, primeiramente \u00e9 necess\u00e1rio importar os dados para o banco de dados, alterando corretamente os par\u00e2metros   abaixo: <pre><code>shp2pgsql -s 4674 -W \"UTF-8\" ProdesCerrado_2019_incremento.shp public.prodes2019 | psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d &lt;db_name&gt;\n</code></pre> <p>O comando acima importa os dados do Shapefile em uma tabela nomeada <code>prodes2019</code>. Na ocasi\u00e3o, o PRODES-Cerrado 2019 foi disponibilizado sem o campo de identifica\u00e7\u00e3o em qual munic\u00edpio aquele desmatamento ocorreu e com a coluna <code>state</code> que identificava os estados pelo nome por extenso. Portanto, inicialmente deve-se alterar o padr\u00e3o dos estados para utilizar o campo uf com apenas 2 caracteres.</p> <pre><code>ALTER TABLE prodes2019 ADD COLUMN uf character varying(2);\n</code></pre> <p>Em seguida, preencha o campo <code>uf</code> com o seguinte comando:</p> <pre><code>update prodes2019 set uf = CASE\nwhen state = 'PAR\u00c1' THEN 'PA'\nwhen state = 'MATO GROSSO' THEN 'MT'\nWHEN state = 'PIAU\u00cd' THEN 'PI'\nWHEN state = 'BAHIA' THEN 'BA'\nWHEN state = 'MARANH\u00c3O' THEN 'MA'\nWHEN state = 'TOCANTINS' THEN 'TO'\nWHEN state = 'MATO GROSSO DO SUL' THEN 'MS'\nWHEN state = 'MINAS GERAIS' THEN 'MG'\nWHEN state = 'PARAN\u00c1' THEN 'PR'\nWHEN state = 'ROND\u00d4NIA' THEN 'RO'\nWHEN state = 'S\u00c3O PAULO' THEN 'SP'\nWHEN state = 'DISTRITO FEDERAL' THEN 'DF'\nWHEN state = 'GOI\u00c1S' THEN 'GO'\nELSE '00'\nEND\n</code></pre> <p>Al\u00e9m dos estados, caso as novas atualiza\u00e7\u00f5es n\u00e3o possuam a identifica\u00e7\u00e3o do munic\u00edpio, deve-se verificar se o mesmo pol\u00edgono de desmatamento se encontra em mais de um munic\u00edpio ao mesmo tempo, o que pode ser alcan\u00e7ado com a query abaixo. Vale ressaltar que os passos descritos abaixo s\u00f3 devem ser executados caso o INPE n\u00e3o identifique o munic\u00edpio onde ocorreu o desmatamento.</p> <pre><code>SELECT prodes.gid, count(city.*)\nFROM prodes2019 prodes\ninner join municipios_cerrado city on ST_INTERSECTS(city.geom, prodes.geom)\nGROUP BY prodes.gid HAVING COUNT(city.*) &gt; 1\n</code></pre> <p>Em seguida, deve-se copiar os pol\u00edgonos PRODES-Cerrado 2019 para uma tabela alternativa <code>prodes2019_alt</code> (que possui o campo de munic\u00edpio) dividindo o pol\u00edgono nas por\u00e7\u00f5es que pertencem a cada munic\u00edpio. Esta opera\u00e7\u00e3o ir\u00e1 aumentar a quantidade de pol\u00edgonos no banco, por\u00e9m n\u00e3o ir\u00e1 impactar na \u00e1rea desmatada.</p> <pre><code>ALTER TABLE prodes2019 ADD COLUMN county character varying(60);\n</code></pre> <pre><code>insert into prodes2019_alt (id, state, path_row, class_name, image_date, year, area_km2, uf, county, geom)\nselect prodes.id, prodes.state, prodes.path_row, prodes.class_name, prodes.image_date, prodes.year, prodes.area_m2, prodes.uf, city.nm_municip, ST_Multi(ST_INTERSECTION(prodes.geom, city.geom)) from prodes2019 prodes inner join municipios_cerrado city on ST_INTERSECTS(prodes.geom, city.geom)\n</code></pre> <p>Al\u00e9m de criar o campo <code>county</code>, deve-se tamb\u00e9m j\u00e1 armazenar o valor da \u00e1rea do desmatamento de cada pol\u00edgono na tabela <code>prodes2019_alt</code> j\u00e1 convertendo para km\u00b2.</p> <pre><code>update prodes2019_alt\nset area_km2 = ST_AREA(geom::GEOGRAPHY) / 1000000.0\nwhere year = 2019\n</code></pre> <p>Por fim, deve-se inserir os pol\u00edgonos PRODES-Cerrado 2019 na tabela oficial onde est\u00e3o todos os pol\u00edgonos, incluindo a longitude e latitude do Centr\u00f3ide do pol\u00edgono.</p> <pre><code>insert into prodes_cerrado (uid, pathrow, view_date, source, areamunkm, uf, geom, year, classname, lat, long)\nselect id, path_row, image_date, 'inpe cerrado' , area_m2, uf, geom, year, class_name, st_y(ST_PointOnSurface(geom)), st_x(ST_PointOnSurface(geom)) from prodes2019_alt\n</code></pre>"},{"location":"03-dad_vetoriais/#deter-cerrado","title":"DETER Cerrado","text":"<p>Devido a constante revis\u00e3o do DETER-Cerrado, onde pol\u00edgonos de desmatamento s\u00e3o reanalisados e validados antes de sua consolida\u00e7\u00e3o no PRODES-Cerrado, ao atualizar este produto \u00e9 necess\u00e1rio excluir todos os dados anteriores sobre ele e inserir o novo por completo. Para tal, o primeiro passo \u00e9 excluir os registros na tabela <code>deter_cerrado</code>.</p> <pre><code>ALTER TABLE \"public\".\"pontos_campo\" DROP CONSTRAINT \"pontos_campo_deter_id_fkey\";\nTRUNCATE TABLE deter_cerrado RESTART IDENTITY;\nALTER TABLE \"public\".\"pontos_campo\" ADD CONSTRAINT \"pontos_campo_deter_id_fkey\" FOREIGN KEY (deter_id) REFERENCES deter_cerrado(gid);\n</code></pre> <p>Obs. Caso seja necess\u00e1rio desativar e reativar mais restri\u00e7\u00f5es (CONSTRAINTS), utilize a query abaixo para encontrar todas as restri\u00e7\u00f5es presentes no banco e em seguida a query seguinte para descobrir todas as queries de reconstru\u00e7\u00e3o das constraints.</p> <pre><code>/*\nDROP CONSTRAINTS SCRIPT\n*/\nSELECT 'ALTER TABLE \"'||nspname||'\".\"'||relname||'\" DROP CONSTRAINT \"'||conname||'\";'\nFROM pg_constraint INNER JOIN pg_class ON conrelid=pg_class.oid INNER JOIN pg_namespace ON pg_namespace.oid=pg_class.relnamespace ORDER BY CASE WHEN contype='f' THEN 0 ELSE 1 END,contype,nspname,relname,conname\n/*\nRECREATE CONSTRAINTS SCRIPT:\n*/\nSELECT 'ALTER TABLE \"'||nspname||'\".\"'||relname||'\" ADD CONSTRAINT \"'||conname||'\" '||\npg_get_constraintdef(pg_constraint.oid)||';'\nFROM pg_constraint\nINNER JOIN pg_class ON conrelid=pg_class.oid\nINNER JOIN pg_namespace ON pg_namespace.oid=pg_class.relnamespace\nORDER BY CASE WHEN contype='f' THEN 0 ELSE 1 END DESC,contype DESC,nspname DESC,relname DESC,conname DESC;\n</code></pre> <p>Em seguida, deve-se realizar o download do Shapefile com todos os Avisos Deter-Cerrado e em seguida pode-se inserir o shape em uma tabela tempor\u00e1ria no banco de dados, nomeada <code>deter_public</code>, atrav\u00e9s do comando:</p> <pre><code>shp2pgsql -s 4674 -W \"UTF-8\" deter_public.shp public.deter_public | psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d &lt;db_name&gt;\n</code></pre> <p>Com o shape carregado na tabela <code>deter_public</code> no banco de dados, basta popular a tabela <code>deter_cerrado</code> com o seguinte comando em SQL:</p> <pre><code>insert into deter_cerrado (classname, path_row, view_date, sensor, satellite, areamunkm, county, uf, uc, geom)\nselect classname, path_row, view_date, sensor, satellite, areamunkm, municipali, uf, uc, geom from deter_public\n</code></pre> <p>Por fim, deve-se tamb\u00e9m atualizar a latitude e longitude do centr\u00f3ide do pol\u00edgono DETER-Cerrado:</p> <pre><code>update deter_cerrado\nset lat = st_y(ST_PointOnSurface(geom)),\nlong = st_x(ST_PointOnSurface(geom))\nwhere lat is null and long is null;\n</code></pre> <p>Ap\u00f3s a inser\u00e7\u00e3o dos pontos, deve-se excluir os pol\u00edgonos que j\u00e1 foram antropizados e reconhecido pelo PRODES-Cerrado, utilizando a query abaixo:</p> <pre><code>DELETE FROM deter_cerrado d\nUSING prodes_cerrado p WHERE ST_EQUALS(p.geom, d.geom);\n</code></pre>"},{"location":"03-dad_vetoriais/#cadastro-ambiental-rural-car","title":"Cadastro Ambiental Rural (CAR)","text":"<p>Ap\u00f3s a cria\u00e7\u00e3o dos quatro shapefiles com os principais componentes do CAR (Propriedades Rurais, Reserva Legal, \u00c1rea de Preserva\u00e7\u00e3o Permanence e Nascentes) deve-se inserir corretamente estes dados no banco de dados.</p> <pre><code>shp2pgsql -s 4674 -W \"UTF-8\" car.shp public.car_cerrado_temp | psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d &lt;db_name&gt;\n</code></pre>"},{"location":"03-dad_vetoriais/#cruzamentos-espaciais-entre-os-dados","title":"Cruzamentos espaciais entre os dados","text":""},{"location":"03-dad_vetoriais/#prodes-e-deter-cerrado-com-o-car","title":"PRODES e DETER-Cerrado com o CAR","text":"<p>Ap\u00f3s realizar a atualiza\u00e7\u00e3o dos dados PRODES-Cerrado, DETER-Cerrado e do CAR \u00e9 necess\u00e1rio realizar os cruzamentos espaciais entre estes dados. Portanto, primeiramente \u00e9 importante apagar os registros anteriores. Inicialmente iremos apagar a tabela de relacionamento entre os dados do CAR e os pol\u00edgonos PRODES e DETER-Cerrado.</p> <pre><code>TRUNCATE TABLE car_desmat RESTART IDENTITY;\n</code></pre> <p>Em seguida, inicialmente deve-se inserir (em rela\u00e7\u00e3o de 1:1) o cruzamento entre as propriedades do CAR e os pol\u00edgonos PRODES-Cerrado na tabela <code>car_desmat</code>:</p> <pre><code>insert into car_desmat (car_cerrado_id, idt_imovel, prodes_id)\nselect car.gid, car.idt_imovel, prodes.gid from car_cerrado car inner join prodes_cerrado prodes on ST_INTERSECTS(car.geom, prodes.geom) where prodes.year &gt;= 2013\n</code></pre> <p>Ap\u00f3s o PRODES-Cerrado, insere-se os cruzamentos com o DETER-Cerrado:</p> <pre><code>insert into car_desmat (car_cerrado_id, idt_imovel, deter_id)\nselect car.gid, car.idt_imovel, prodes.gid from car_cerrado car inner join deter_cerrado deter on ST_INTERSECTS(car.geom, deter.geom)\n</code></pre> <p>Com as rela\u00e7\u00f5es criadas, atualiza-se a tabela <code>car_desmat</code> com a quantidade de nascentes e cada desmatamento detectado dentro de uma propriedade rural:</p> <pre><code>update car_desmat\nset qnt_nascente = sub.qnt from (\nselect c.car_cerrado_id as internocar, c.prodes_id as internoprodes, count(rl.gid) as qnt\nfrom geo_car_nascente_cerrado rl\ninner join car_desmat c on c.idt_imovel = rl.idt_imovel group by 1,2\n) as sub where sub.internocar = car_desmat.car_cerrado_id and sub.internoprodes = car_desmat.prodes_id\n</code></pre>"},{"location":"03-dad_vetoriais/#prodes-e-deter-cerrado-com-o-car_1","title":"PRODES e DETER-Cerrado com o CAR","text":"<p>Ap\u00f3s realizar a atualiza\u00e7\u00e3o dos dados PRODES-Cerrado e DETER-Cerrado \u00e9 necess\u00e1rio realizar os cruzamentos espaciais entre estes dados e as \u00e1reas tratadas como Especiais pelo Cerrado DPAT, tais como:</p> <ul> <li>Terras Ind\u00edgenas (TI).</li> <li>Comunidades Quilombolas (AQ).</li> <li>Unidades de Conserva\u00e7\u00e3o de Uso Sustent\u00e1vel (UCUS). </li> <li>Unidades de Conversava\u00e7\u00e3o de Prote\u00e7\u00e3o Integral (UCPI).</li> </ul> <p>O tipo de cruzamento a ser realizado \u00e9 o c\u00e1lculo das dist\u00e2ncias entre cada pol\u00edgono PRODES e/ou DETER e cada \u00e1rea especial, no intuito de descobrir a \u00e1rea mais pr\u00f3xima de cada pol\u00edgono.</p> <p>Portanto, primeiramente \u00e9 importante apagar os registros anteriores. Inicialmente iremos apagar a tabela de relacionamento entre os dados do PRODES/DETER e as \u00e1reas especiais. A fim de facilitar, iremos utilizar ``{origin_table}'' para identificar a tabela de origem, seja ela PRODES ou DETER-Cerrado. <pre><code>TRUNCATE TABLE {origin_table}_distancias RESTART IDENTITY;\n</code></pre></p> <p>Em seguida, inicialmente deve-se inserir (em rela\u00e7\u00e3o de 1:1) o cruzamento entre a \u00e1rea especial de TI e os pol\u00edgonos {origin-table}-Cerrado na tabela <code>{origin_table}_distancias</code>:</p> <pre><code>insert into {origin_table}_distancias ({origin_table}_id, ti_gid, ti_dist)\nselect a.gid as {origin_table}_id, b.gid as ti_gid, b.distance as distance\nfrom {origin_table}_cerrado a cross join lateral\n(select b.gid, -- (a.geom::geography &lt;-&gt; b.geom::geography)/1000.0 as distance \nCAST(ST_DistanceSphere(a.geom, b.geom)/1000.0 as numeric) as distance\nfrom areas_quilombolas b --where st_dwithin(a.geom,b.geom,400) -- caso queira filtrar por dist\u00e2ncia m\u00ednima\norder by distance asc limit 1\n) as b\n</code></pre> <p>Em seguida, atualiza-se os demais campos referentes a Comunidades Quilombola (colunas q_gid, q_dist em deter_distancias e tabela 'areas_quilombolas'), UCUS (colunas ucus_gid, ucus_dist em deter_distancias e tabela 'ucs_uso_sustentavel') e UCPI (colunas ucpi_gid, ucpi_dist em deter_distancias e tabela 'ucs_protecao_integral') na tabela de relacionamento:</p> <pre><code>update deter_distancias set q_gid = b.gid,\nq_dist = b.distance\nfrom deter_cerrado a\ncross join lateral\n(select b.gid, -- (a.geom::geography &lt;-&gt; b.geom::geography)/1000.0 as distance \nCAST(ST_DistanceSphere(a.geom, b.geom)/1000.0 as numeric) as distance\nfrom areas_quilombolas b --where st_dwithin(a.geom,b.geom,400) -- caso queira filtrar por dist\u00e2ncia m\u00ednima\norder by distance asc limit 1\n) as b\nwhere deter_distancias.deter_id = a.gid </code></pre>"},{"location":"03-dad_vetoriais/#prodes-cerrado-com-os-pontos-da-validacao-de-campo","title":"PRODES-Cerrado com os pontos da Valida\u00e7\u00e3o de Campo","text":"<p>Ap\u00f3s atualiza\u00e7\u00e3o dos dado PRODES-Cerrado, \u00e9 necess\u00e1ria a atualiza\u00e7\u00e3o da refer\u00eancia ao pol\u00edgono PRODES-Cerrado em rela\u00e7\u00e3o aos pontos visitados durante a valida\u00e7\u00e3o de campo. Para tal, executasse a seguinte query:</p> <pre><code>UPDATE pontos_campo\nset prodes_id = p.gid\nfrom prodes_cerrado p\nwhere pontos_campo.prodes_id is null and ST_INTERSECTS(p.geom, pontos_campo.geom)\n</code></pre> <p>Em seguida, realiza-se o mesmo processo em rela\u00e7\u00e3o aos pol\u00edgonos DETER-Cerrado:</p> <pre><code>UPDATE pontos_campo\nset deter_id = d.gid\nfrom deter_cerrado d\nwhere pontos_campo.deter_id is null and ST_INTERSECTS(d.geom, pontos_campo.geom)\n</code></pre>"},{"location":"03-dad_vetoriais/#prodes-cerrado-com-os-pontos-da-validacao-amostral","title":"PRODES-Cerrado com os pontos da Valida\u00e7\u00e3o Amostral","text":"<p>Ap\u00f3s atualiza\u00e7\u00e3o dos dado PRODES-Cerrado, \u00e9 necess\u00e1ria a atualiza\u00e7\u00e3o da refer\u00eancia ao pol\u00edgono PRODES-Cerrado em rela\u00e7\u00e3o aos pontos inspecionados durante a valida\u00e7\u00e3o amostral. Para tal, executasse a seguinte query:</p> <pre><code>UPDATE validacao_amostral\nset prodes_id = p.gid\nfrom prodes_cerrado p\nwhere validacao_amostral.prodes_id is null and ST_INTERSECTS(p.geom, validacao_amostral.geom)\n</code></pre>"},{"location":"03-dad_vetoriais/#prodes-cerrado-acumulado-em-todas-regioes-municipios-e-estados","title":"PRODES-Cerrado acumulado em todas regi\u00f5es (Munic\u00edpios e Estados)","text":"<p>Ap\u00f3s a atualiza\u00e7\u00e3o do PRODES-Cerrado, tamb\u00e9m \u00e9 necess\u00e1rio o c\u00e1lculo do desmatamento acumulado por munic\u00edpio e tamb\u00e9m por estado. Para tal, deve-se inicialmente popular a tabela <code>prodes_regions</code> que ir\u00e1 armazenar o <code>id</code> da regi\u00e3o (munic\u00edpio ou estado) e a sua \u00e1rea desmatada. Note que deve-se atualizar a refer\u00eacia <code>where p.year = 2019</code> para o ano do desmatamento inserido no banco. Portanto, pode-se utilizar a seguinte query:</p> <pre><code>/* Inserir desmatamento acumulado por estado */\ninsert into prodes_regions (region_id, sum_area_prodes, year)\nselect r.gid, sum(p.areamunkm), p.year from regions r inner join prodes_cerrado p on p.uf = r.value where p.year = 2019 and r.type = 'state' group by 1, 3\n/* Inserir desmatamento acumulado por munic\u00edpio */\ninsert into prodes_regions (region_id, sum_area_prodes, year)\nselect r.gid, sum(p.areamunkm), p.year from regions r inner join prodes_cerrado p on p.cd_geocmu = r.cd_geocmu where p.year = 2019 and r.type = 'city' group by 1, 3\n</code></pre> <p>Em seguida, deve-se atualizar os elementos rec\u00e9m inseridos na tabela <code>prodes_regions</code> com a \u00e1rea desmatada dentro de APPs e Reservas Legais:</p> <pre><code>/* Atualiza\u00e7\u00e3o para desmatameto acumulado em APP e RL por estado */\n/* APP */\nupdate prodes_regions\nset area_app = internal.area_desmat\nfrom (SELECT sum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision) as area_desmat, r.gid as internoregion, p.year as internoyear\nfrom prodes_cerrado p inner join geo_car_app_cerrado lc on lc.uf = p.uf\ninner join regions r on r.value = lc.uf where ST_INTERSECTS(p.geom, lc.geom) and r.type = 'state' and p.year = 2019 group by 2,3)  as internal\nwhere prodes_regions.region_id = internal.internoregion AND prodes_regions.year = internal.internoyear and internal.internoyear = 2019\n/* RL */\nupdate prodes_regions\nset area_rl = internal.area_desmat\nfrom (SELECT sum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision) as area_desmat, r.gid as internoregion, p.year as internoyear\nfrom prodes_cerrado p inner join geo_car_reserva_legal_cerrado lc on lc.uf = p.uf\ninner join regions r on r.value = lc.uf where ST_INTERSECTS(p.geom, lc.geom) and r.type = 'state' and p.year = 2019 group by 2,3)  as internal\nwhere prodes_regions.region_id = internal.internoregion AND prodes_regions.year = internal.internoyear and internal.internoyear = 2019\n/* Atualiza\u00e7\u00e3o para desmatameto acumulado em APP e RL por munic\u00edpio */\n/* APP */\nupdate prodes_regions\nset area_app = internal.area_desmat\nfrom (SELECT sum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision) as area_desmat, r.gid as internoregion, p.year as internoyear\nfrom prodes_cerrado p inner join geo_car_app_cerrado lc on lc.cd_geocmu = p.cd_geocmu\ninner join regions r on r.cd_geocmu = lc.cd_geocmu where ST_INTERSECTS(p.geom, lc.geom) and r.type = 'city' and p.year = 2019 group by 2,3)  as internal\nwhere prodes_regions.region_id = internal.internoregion AND prodes_regions.year = internal.internoyear and internal.internoyear = 2019\n/* RL */\nupdate prodes_regions\nset area_rl = internal.area_desmat\nfrom (SELECT sum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision) as area_desmat, r.gid as internoregion, p.year as internoyear\nfrom prodes_cerrado p inner join geo_car_reserva_legal_cerrado lc on lc.cd_geocmu = p.cd_geocmu\ninner join regions r on r.cd_geocmu = lc.cd_geocmu where ST_INTERSECTS(p.geom, lc.geom) and r.type = 'city' and p.year = 2019 group by 2,3)  as internal\nwhere prodes_regions.region_id = internal.internoregion AND prodes_regions.year = internal.internoyear and internal.internoyear = 2019\n</code></pre>"},{"location":"03-dad_vetoriais/#prodes-cerrado-com-todas-regioes-municipios-e-estados-em-relacao-ao-uso-do-solo","title":"PRODES-Cerrado com todas regi\u00f5es (Munic\u00edpios e Estados) em rela\u00e7\u00e3o ao uso do solo","text":"<p>Ap\u00f3s atualiza\u00e7\u00e3o do PRODES-Cerrado, tamb\u00e9m \u00e9 necess\u00e1rio o c\u00e1lculo da propor\u00e7\u00e3o de desmatamento em cada tipo de uso do solo para os pol\u00edgonos rec\u00e9m inseridos no banco de dados. Desta forma, para calcular e inserir no banco esta informa\u00e7\u00e3o para estados e munic\u00edpios respectivamente deve-se executar as seguintes queries. Ap\u00f3s as queries de inser\u00e7\u00e3o dos dados, \u00e9 necess\u00e1rio ajustar a coluna <code>total_area_classe_lulc</code> da tabela <code>prodes_regions_lulc</code>, que representa o total da \u00e1rea de cada classe de uso solo dos mapas.</p> <pre><code>Terraclass\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'state', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'terraclass'\nfrom regions r\ninner join uso_solo_terraclass lc on r.value = lc.uf\ninner join prodes_cerrado p on r.value = p.uf\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'uso_solo_terraclass'\nwhere r.type = 'state' and ST_INTERSECTS(p.geom, lc.geom) and p.year = 2019 group by 1,2,3,4,5;\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'city', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'terraclass'\nfrom regions r\ninner join uso_solo_probio lc on r.cd_geocmu = lc.cd_geocmu\ninner join prodes_cerrado p on r.cd_geocmu = p.cd_geocmu\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'uso_solo_terraclass'\nwhere r.type = 'city' and ST_INTERSECTS(p.geom, lc.geom) and p.year &gt; 2000 and p.year &lt; 2012 group by 1,2,3,4,5;\n</code></pre> <pre><code>/* Atualiza\u00e7\u00e3o do campo `total_area_classe_lulc` */\n/* Por Munic\u00edpio */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, lc.cd_geocmu as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from uso_solo_terraclass lc\ninner join regions r on lc.cd_geocmu = r.cd_geocmu where lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'city' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n/* Por Estado */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, r.value as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from uso_solo_terraclass lc\ninner join regions r on lc.uf = r.value where r.type = 'state' AND lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'state' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n</code></pre> <pre><code>PROBIO\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'state', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'probio'\nfrom regions r\ninner join uso_solo_probio lc on r.value = lc.uf\ninner join prodes_cerrado p on r.value = p.uf\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'uso_solo_probio'\nwhere r.type = 'state' and ST_INTERSECTS(p.geom, lc.geom) and p.year &gt; 2000 and p.year &lt; 2013 group by 1,2,3,4,5;\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'city', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'probio'\nfrom regions r\ninner join uso_solo_probio lc on r.cd_geocmu = lc.cd_geocmu\ninner join prodes_cerrado p on r.cd_geocmu = p.cd_geocmu\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'uso_solo_probio'\nwhere r.type = 'city' and ST_INTERSECTS(p.geom, lc.geom) and p.year &gt; 2000 and p.year &lt; 2012 group by 1,2,3,4,5;\n</code></pre> <pre><code>/* Atualiza\u00e7\u00e3o do campo `total_area_classe_lulc` */\n/* Por Munic\u00edpio */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, lc.cd_geocmu as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from uso_solo_probio lc\ninner join regions r on lc.cd_geocmu = r.cd_geocmu where lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'city' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n/* Por Estado */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, r.value as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from uso_solo_probio lc\ninner join regions r on lc.uf = r.value where r.type = 'state' AND lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'state' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n</code></pre> <pre><code>Agrosat\u00e9lite\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'state', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'agrosatelite'\nfrom regions r\ninner join agricultura_agrosatelite lc on r.value = lc.uf\ninner join prodes_cerrado p on r.value = p.uf\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'agricultura_agrosatelite'\nwhere r.type = 'state' and ST_INTERSECTS(p.geom, lc.geom) and p.year = 2019 group by 1,2,3,4,5;\n</code></pre> <pre><code>insert into prodes_regions_lulc (region_id, year, type, classe_lulc, color, desmat_area_classe_lulc, fonte)\nselect r.gid, p.year, 'city', lc.classe, g.color,\nsum(st_area(safe_intersection(p.geom, lc.geom)::geography) / 1000000.0::double precision), 'agrosatelite'\nfrom regions r\ninner join agricultura_agrosatelite lc on r.cd_geocmu = lc.cd_geocmu\ninner join prodes_cerrado p on r.cd_geocmu = p.cd_geocmu\nINNER JOIN graphic_colors g on unaccent(g.name) ilike unaccent(lc.classe) AND g.table_rel = 'agricultura_agrosatelite'\nwhere r.type = 'city'  and ST_INTERSECTS(p.geom, lc.geom) and p.year = 2019 group by 1,2,3,4,5;\n</code></pre> <pre><code>/* Atualiza\u00e7\u00e3o do campo `total_area_classe_lulc` */\n/* Por Munic\u00edpio */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, lc.cd_geocmu as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from agricultura_agrosatelite lc\ninner join regions r on lc.cd_geocmu = r.cd_geocmu where lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'city' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n/* Por Estado */\nupdate prodes_regions_lulc\nset total_area_classe_lulc = internal.total_area_lulc\nfrom\n(select r.gid as id, r.value as code, lc.classe as classeInt,  sum(st_area(lc.geom,true)/1000000.0::double precision) as total_area_lulc from agricultura_agrosatelite lc\ninner join regions r on lc.uf = r.value where r.type = 'state' AND lc.bioma='CERRADO' group by 1,2,3) as internal\nwhere prodes_regions_lulc = 'state' and prodes_regions_lulc.region_id = internal.id and prodes_regions_lulc.classe_lulc = internal.classeInt\n</code></pre>"},{"location":"04-metricas_de_avaliacao/","title":"M\u00e9tricas de avalia\u00e7\u00e3o","text":""},{"location":"04-metricas_de_avaliacao/#dados-de-campos","title":"Dados de campos","text":""},{"location":"04-metricas_de_avaliacao/#realizacao-das-atividades-de-campo","title":"Realiza\u00e7\u00e3o das atividades de campo","text":"<p>Com o objetivo de avaliar os desmatamentos detectados pelos sistemas PRODES-Cerrado e DETER-Cerrado foram realizadas quatro atividades de campo, priorizando visitas \u00e0s regi\u00f5es com maior quantidade de detec\u00e7\u00f5es. A elabora\u00e7\u00e3o dos trajetos tamb\u00e9m contemplou a ocorr\u00eancia de desmatamentos em diferentes fitofisionomias, tipos de solo, clima, relevo, arranjos socioecon\u00f4micos e produtivos. Buscou-se tamb\u00e9m por uma logistica que contemplasse a otimiza\u00e7\u00e3o tempo e com o pernoite em cidades com infraestrutura adequada para a situa\u00e7\u00e3o (hot\u00e9is, restaurantes e sinal de internet). Destaca-se tamb\u00e9m que, apesar do fator limitante relativo a distribui\u00e7\u00e3o de rodovias, buscou-se pelo equilibrio do percurso em estradas \"principais\" (rodovias estaduais e federais) e vicinais (estradas municipais e acessos a fazendas).</p> <p></p> <p>A defini\u00e7\u00e3o do trecho a ser percorrido em cada dia se baseou em uma dist\u00e2ncia m\u00e9dia percorrida de ~400 km durante um per\u00edodo de 10 horas (8h \u00e0s 18h). A quantidade de \u00e1reas visitadas levou em considera\u00e7\u00e3o o tempo m\u00e9dio gasto em cada parada, sendo ~10 minutos em \u00e1reas sem sobrev\u00f4o de drone e ~20min em \u00e1reas com sobrev\u00f4o de drone. </p> <p>A escolha das \u00e1reas com sobrev\u00f4o de drone se baseou na an\u00e1lise de mapas e imagens de sat\u00e9lite. Foi escolhido um n\u00famero m\u00ednimo de 4 sobrev\u00f4os de drone em cada trecho. Essa sele\u00e7\u00e3o considerou crit\u00e9rios como: dificuldade de detec\u00e7\u00e3o (\u00e1reas campestres, \u00e1reas com elevada quantidade de pastos em est\u00e1gio de degrada\u00e7\u00e3o agron\u00f4mica, \u00e1reas com queimadas recorrentes e \u00e1reas com alta resposta espectral aos efeitos da sazonalidade clim\u00e1tica), tamanhos (\u00e1reas muitos grandes) e restri\u00e7\u00f5es de acesso (considerando a autonomia e o raio de sobrev\u00f4o do drone). Para essas \u00e1reas, de acordo com as orienta\u00e7\u00f5es da Ag\u00eancia Nacional de Avia\u00e7\u00e3o Civil (ANAC), foram realizadas requisi\u00e7\u00f5es de autoriza\u00e7\u00e3o de sobrev\u00f4o junto ao DECEA por meio do SARPAS.</p> <p>Ap\u00f3s a defini\u00e7\u00e3o de cada trecho, foram preparados mapas georreferenciados em formato GeoPDF para posterior inser\u00e7\u00e3o no aplicativo de celular Avenza Maps. Estes mapas contemplavam os seguintes dados:</p> <ul> <li>Imagem de sat\u00e9lite (Sentinel 2 com composi\u00e7\u00e3o R4 G3 B2).</li> <li>Trajeto previamente definido, com eventuais acessos \u00e0s \u00e1reas desmatadas.</li> <li>\u00c1reas detectadas pelo PRODES-Cerrado (a partir de 2016).</li> <li>\u00c1reas detectadas pelo DETER-Cerrado (a partir de 2017).</li> <li>Localiza\u00e7\u00e3o das cidades de pernoite.</li> <li>\u00c1reas previamente selecionadas para paradas sem sobrev\u00f4o de drone.</li> <li>\u00c1reas previamente selecionadas para paradas com sobrev\u00f4o de drone.</li> </ul> <p></p> <p>Devido a restri\u00e7\u00e3o para importa\u00e7\u00f5es de arquivos com at\u00e9 500 mb, cada trecho foi subdividido em subtrechos. Destaca-se tamb\u00e9m que a importa\u00e7\u00e3o de mapas no formato GeoPDF dispensou a necessidade de conex\u00e3o de internet para a coleta dos dados.</p> <p></p> <p>Para cada mapa importado pelo aplicativo Avenza Maps foi criado um formul\u00e1rio com os seguintes campos:</p> <ul> <li>Classe (PRODES 16, 17, 18 ou DETER 18 ou 19)</li> <li>Cobertura (uso/cobertura observado no campo)</li> <li>Observa\u00e7\u00e3o (observa\u00e7\u00e3o adicional sobre a \u00e1rea visitada)</li> <li>ID do sobrev\u00f4o (caso ocorresse o sobrev\u00f4o no poligono visitado)</li> </ul> <p>Durante a realiza\u00e7\u00e3o de cada campo, a pessoa respons\u00e1vel pela coleta registrava um marcador sobre a \u00e1rea desmatada. Essa marca\u00e7\u00e3o podia ser feita sem a necessidade de estar exatamente no local, o que favoreceu o registro de pontos com sobrev\u00f4o de drone (um exemplo dessa situa\u00e7\u00e3o \u00e9 ilustrado com a letra \"B\" na figura abaixo).</p> <p></p> <p>No final de cada dia as fotos e os registros dos question\u00e1rios eram exportados, respectivamente, nos formatos .jpg e .csv. A planilha exportada continha as seguintes colunas:</p> <ul> <li>ID</li> <li>Campo</li> <li>Trecho</li> <li>Localizador</li> <li>Sobrev\u00f4o</li> <li>Data</li> <li>Latitude</li> <li>Longitude</li> <li>Classe</li> <li>Observa\u00e7\u00e3o</li> <li>Cobertura</li> </ul> <p>O nome das imagens correspondente a cada \u00e1rea visitada era formado pelo prefixo \"Placemark/Localizador\" e o respectivo ID. Caso houvesse mais de uma foto, esse id era acrescido de um sufixo indicando o sub-id de cada foto.</p>"},{"location":"04-metricas_de_avaliacao/#processo-de-atualizacao","title":"Processo de atualiza\u00e7\u00e3o","text":"<p>Ap\u00f3s a execu\u00e7\u00e3o das viagens de campo, deve-se organizar as m\u00eddias digitais obtidas em tr\u00eas pastas principais: <code>fotos_camera</code>, <code>fotos_drone</code> e <code>videos_drone</code>. Internamente dever\u00e1 conter subpastas com identificadores de qual visita de campo est\u00e1 sendo documentada. Por exemplo, a subpasta <code>Campo_01</code> \u00e9 referente as m\u00eddias obtidas durante a primeira valida\u00e7\u00e3o de campo. Dentro da pasta de <code>Campo</code>, deve-se criar subpastas com o identificador do <code>Trecho</code> onde foi retirada a fotografia ou v\u00eddeo de drone. E por fim, dentro da pasta referente ao Trecho, deve-se criar subpastas com o <code>Localizador</code> \u00fanico de cada m\u00eddia. </p> <p>Portanto, a imagem abaixo apresenta estrutura de pastas e arquivos referente as fotos retiradas do solo durante a visita ao primeiro campo, ao atravessar o trecho anotado como '1A' e localizador \u00fanico definido como Placemark 'numero'.</p> <p></p> <p>Ap\u00f3s organiza\u00e7\u00e3o dos arquivos em pastas, uma planilha para controle e organiza\u00e7\u00e3o das imagens. Um exemplo de arquivo .csv que realiza a organiza\u00e7\u00e3o para o Campo_01, trecho '1A' pode ser encontrado neste link. Conforme, pode ser observado no exemplo, \u00e9 importante que o arquivo csv apresente o seguinte cabe\u00e7alho:</p> <pre><code>id,Campo,Trecho,Localizado,Sobrev\u00f4o,Data,Latitude,Longitude,Classe,Obs,Cobertura\n</code></pre> <p>Uma vez que o arquivo .csv esteja preenchido com a informa\u00e7\u00e3o de todos os campos. Deve-se realizar a inser\u00e7\u00e3o do mesmo no banco de dados, o que pode ser alcan\u00e7ado pela execu\u00e7\u00e3o do seguinte comando:</p> <pre><code>psql -d &lt;db_name&gt; --user=&lt;db_user&gt; -c \"COPY pontos_campo FROM '&lt;caminho_para_o_arquivo_csv&gt;.csv' delimiter ',' CSV [HEADER];\"\n</code></pre> <p>Ap\u00f3s importa\u00e7\u00e3o no banco de dados, \u00e9 necess\u00e1ria a cria\u00e7\u00e3o da geometria de ponto na tabela <code>pontos_campo</code>.</p> <pre><code>UPDATE pontos_campo\nSET geom = ST_SetSRID(ST_MakePoint(lon, lat), 4674)\nWHERE geom is null;\n</code></pre> <p>Em seguida \u00e9 necess\u00e1rio realizar o cruzamento entre o PRODES e DETER-Cerrado em rela\u00e7\u00e3o aos pontos visitados para associar o ponto visitado em campo com um pol\u00edgono de desmatamento.</p> <pre><code>UPDATE pontos_campo SET prodes_id = p.gid\nFROM prodes_cerrado p\nWHERE pontos_campo.prodes_id IS NULL\nAND ST_INTERSECTS(pontos_campo.geom, p.geom)\n</code></pre> <pre><code>UPDATE pontos_campo SET deter_id = d.gid\nFROM deter_cerrado d\nWHERE pontos_campo.deter_id IS NULL\nAND ST_INTERSECTS(pontos_campo.geom, d.geom)\n</code></pre> <p>Geralmente as m\u00eddias digitais recolhidas durante a valida\u00e7\u00e3o de campo (principalmente as obtidas durante o sobrev\u00f4o de drone) s\u00e3o compostas por arquivos pesados. Para tal, aplica-se um script para compres\u00e3o dos mesmos a fim de facilitar a sua disponibiliza\u00e7\u00e3o no Cerrado DPAT. O script a ser executado \u00e9 o <code>compress_videos.sh</code>, por\u00e9m antes de executar \u00e9 necess\u00e1rio alterar as linhas 5 e 6 com o caminho at\u00e9 o diret\u00f3rio dos v\u00eddeos e fotos de drone respectivamente.</p> <pre><code>./compress_videos.sh\n</code></pre> <p>A vers\u00e3o atual do script <code>compress_videos.sh</code> n\u00e3o comporta a compres\u00e3o de imagens de c\u00e2mera, por\u00e9m caso desejem comprimir tamb\u00e9m estas, basta descomentar as linhas 7 e 42-47.</p> <p>Em seguida, a fim de realizar uma organiza\u00e7\u00e3o nas fotos comprimidas em um diret\u00f3rio \u00fanico chamado <code>dados_padronizados</code>, adequando corretamente os nomes dos arquivos de acordo com o padr\u00e3o descrito no arquivo .csv, deve-se executar o script <code>organize_fotos.js</code>. Antes de executar, confira as linhas 38 em rela\u00e7\u00e3o a localiza\u00e7\u00e3o do arquivo .csv e caso tenha-se comprimido as fotografias de c\u00e2mera, verificar tamb\u00e9m as linhas 52 e 53.</p> <pre><code>node organize_fotos.js\n</code></pre> <p>Por fim, deve-se configurar o caminho para a pasta <code>dados_padronizados</code> no arquivo de configura\u00e7\u00e3o <code>.env</code> no Application Server utilizando diretive <code>FIELD_DATA_DIR</code>. Por exemplo:</p> <pre><code>FIELD_DATA_DIR=/media/campo/dados_padronizados\n</code></pre>"},{"location":"04-metricas_de_avaliacao/#dados-de-validacao-amostral","title":"Dados de valida\u00e7\u00e3o amostral","text":"<p>O processo de valida\u00e7\u00e3o do PRODES-Cerrado se baseou em uma amostragem aleat\u00f3ria estratificada a partir de estratos definidos dentro e fora das \u00e1reas mapeadas pelo PRODES-Cerrado (antr\u00f3pico 2000 e incrementos 2002-2019), considerando um intervalo de confian\u00e7a de 95%, erro padr\u00e3o de 3% e uma vari\u00e2ncia de 50%. O detalhamento do desenho amostral \u00e9 relatado no artigo \"Quality assessment of the PRODES Cerrado deforestation data\".</p> <p></p> <p>O tamanho amostral para cada estrato (assim como a respectiva popula\u00e7\u00e3o em pixels) \u00e9 mostrado na figura abaixo.</p> <p></p> <p></p>"},{"location":"04-metricas_de_avaliacao/#sorteio-de-novos-pontos","title":"Sorteio de novos pontos","text":"<p>Para a valida\u00e7\u00e3o amostral de um novo ano, um novo sorteio de pontos deve ser realizado dentro dos novos incrementos de desmatamento e da \u00e1rea que ainda n\u00e3o foi mapeada pelo PRODES-Cerrado (i.e., vegeta\u00e7\u00e3o nativa). Esse novo sorteio, baseado no tamanho amostral definido para cada estrato, pode ser realizado por meio do software QGIS de acordo com as seguintes etapas:</p> <ul> <li>Sorteio dos pontos dentro dos novos incrementos de desmatamento.<ul> <li>Execu\u00e7\u00e3o da ferramenta \"dissolve\" (op\u00e7\u00e3o presente na maior parte dos softwares e bibliotecas SIG).</li> <li>Sorteio dos pontos por meio da ferramenta \"Pontos aleat\u00f3rios no interior de poligonos\".</li> </ul> </li> <li>Sorteio dos pontos dentro dos estratos fora da m\u00e1scara antr\u00f3pica (8 \"flags\" criadas pelo BFastClassify)<ul> <li>Convers\u00e3o raster \u2192 vetor (o download do raster utilizado na valida\u00e7\u00e3o amostral do PRODES-Cerrado 2019 est\u00e1 disponibilizado para download)</li> <li>Execu\u00e7\u00e3o da ferramenta \"dissolve\" (op\u00e7\u00e3o presente na maior parte dos softwares e bibliotecas SIG)</li> <li>Sorteio dos pontos por meio da ferramenta \"Pontos aleat\u00f3rios no interior de poligonos\".</li> </ul> </li> <li>Execu\u00e7\u00e3o da ferramenta \"Mesclar camadas vetoriais\" para juntar os pontos dentro dos estratos antr\u00f3picas e naturais.</li> </ul>"},{"location":"04-metricas_de_avaliacao/#inspecao-no-tvi","title":"Inspe\u00e7\u00e3o no TVI","text":"<p>Em fun\u00e7\u00e3o da extens\u00e3o da \u00e1rea e do per\u00edodo a ser avaliado, o processo de aquisi\u00e7\u00e3o de dados pontuais referentes ao uso e cobertura da terra por meio de inspe\u00e7\u00e3o visual em imagens de sensoriamento remoto despende tempo e resulta em um grande volume de dados a serem armazenados. Tendo em vista esta situa\u00e7\u00e3o, o Laborat\u00f3rio de Processamento de Imagens e Geoprocessamento da Universidade Federal de Goi\u00e1s (LAPIG - UFG) desenvolveu uma ferramenta online e de c\u00f3digo aberto com o prop\u00f3sito de otimizar a inspe\u00e7\u00e3o de pontos em imagens de sat\u00e9lite.</p> <p>A ferramenta TVI (Temporal Visual Inspection) utiliza uma arquitetura web, baseada em softwares livres, com banco de dados MongoDB e servidor de aplica\u00e7\u00e3o NodeJs. O banco de dados \u00e9 respons\u00e1vel por armazenar todas as informa\u00e7\u00f5es referente aos pontos (ex: classes atribu\u00eddas por um int\u00e9rpretes, coordenadas geogr\u00e1ficas, etc), sendo que sua alimenta\u00e7\u00e3o ocorre por meio de um m\u00f3dulo de importa\u00e7\u00e3o que recebe como entrada um arquivo GeoJSON com as coordenadas dos pontos a serem interpretados. Ap\u00f3s este processo, a ferramenta busca as imagens que ser\u00e3o inspecionadas.</p> <p></p> <p>As imagens s\u00e3o disponibilizadas junto com dados auxiliares. Ao int\u00e9rprete s\u00e3o fornecidos gr\u00e1ficos de s\u00e9ries temporais de imagens MODIS NDVI (normalized difference vegetation index) e precipita\u00e7\u00e3o (TRMM, Tropical Rainfal Measurement Mission, e GPM, Global Precipitation Mission), al\u00e9m do acesso \u00e0s imagens disponibilizadas pelo software Google Earth por meio de um arquivo KML correspondente ao ponto inspecionado. Assim, cabe ao usu\u00e1rio interpretar e associar \u00e0 determinado ponto as respectivas de cobertura do solo (antr\u00f3pico, natural e n\u00e3o observado) observadas em cada ano da s\u00e9rie hist\u00f3rica. Essa associa\u00e7\u00e3o, realizada com base nos crit\u00e9rios adotados pelo INPE, \u00e9 realizada por meio da sele\u00e7\u00e3o do intervalo em que a classe pode ser observada na imagem.</p> <p>Cada um dos pontos sorteados foi inspecionado por 2 interpretes. Para um determinado ano, caso houvesse discord\u00e2ncia entre eles, um terceiro interprete (mais experiente e com maior conhecimento acerca do bioma) foi encarregado de definir uma classe editada com a cobertura por ele observada. A classe final, com o voto majorit\u00e1rio ou editado de todos os pontos, recebeu o nome de \"classe consolidada\".</p> <p>Destaca-se tamb\u00e9m que, al\u00e9m dos crit\u00e9rios adotados pelo INPE, a realiza\u00e7\u00e3o das atividades de campo reuniu um rico material que subsidiou reuni\u00f5es e treinamentos com o prop\u00f3sito de esclarecer comportamentos e caracteristicas presentes no bioma e respectiva representa\u00e7\u00e3o em imagens Landsat. Algumas situa\u00e7\u00f5es discutidas durante estes momentos foram d\u00favidas a respeito do padr\u00e3o espectral de \u00e1reas queimadas e de \u00e1reas desmatadas que ap\u00f3s determinado tempo come\u00e7am a ter a vegeta\u00e7\u00e3o nativa em processo inicial de regenera\u00e7\u00e3o. Um exemplo dessa \u00faltima situa\u00e7\u00e3o \u00e9 mostrado na figura abaixo. Nesse caso, o desmatamento foi detectado no ano de 2017, seguido de regenera\u00e7\u00e3o e uma nova limpeza da \u00e1rea em 2019 (momento da visita em campo).</p> <p></p> <p>Abaixo \u00e9 mostrado um outro exemplo que tamb\u00e9m reflete as dificuldades relatadas e discutidas em cada reuni\u00e3o. Nele, o ano com a detec\u00e7\u00e3o do desmatamento correspondeu a identifica\u00e7\u00e3o do corte raso em 2016, e n\u00e3o \u00e0 ocorr\u00eancia de queimada no ano anterior (\u00e1reas com eventos de degrada\u00e7\u00e3o tamb\u00e9m n\u00e3o foram considerados).</p> <p></p> <p>Dentro do TVI tamb\u00e9m foi desenvolvida uma interface voltada ao acompanhamento do processo de inspe\u00e7\u00e3o. Assim, um usu\u00e1rio com status de supervisor tem a possibilidade de monitorar o desempenho de cada um dos int\u00e9rpretes, de forma a identificar eventuais inconsist\u00eancias e a necessidade de adequa\u00e7\u00f5es aos crit\u00e9rios estabelecido. Nesta interface o supervisor tem acesso a todas as inspe\u00e7\u00f5es efetuadas, havendo a possibilidade de filtragem por classes e int\u00e9rpretes. Tamb\u00e9m s\u00e3o disponibilizados algumas informa\u00e7\u00f5es com o objetivo de contribuir com poss\u00edveis orienta\u00e7\u00f5es e discuss\u00f5es com a equipe envolvida. S\u00e3o elas: n\u00fameros de pontos inspecionados (por int\u00e9rprete), m\u00e9dia de tempo por ponto inspecionado ( int\u00e9rprete), m\u00e9dia de \u201cvotos\u201d (inspe\u00e7\u00f5es) por cobertura (em porcentagem) e n\u00famero de pontos com concord\u00e2ncia. Ressalta-se a import\u00e2ncia de tal interface durante os treinamentos e reuni\u00f5es, onde os interpretes puderam ser acompanhados e orientados por especialistas nos biomas acerca das suas respectivas dificuldades.</p> <p>Ap\u00f3s o processo de inspe\u00e7\u00e3o visual, uma planilha com os registros consolidados e de cada interprete \u00e9 gerada pelo TVI. Por fim, uma tabela final \u00e9 disponibilizada com as classes consolidadas e com o ano da transi\u00e7\u00e3o \"Antropico\" para \"Natural\". Considerando que a classe antr\u00f3pica n\u00e3o \u00e9 revertida para natural, o ano de detec\u00e7\u00e3o pode ser definido de diferentes formas (e.g., scripts, filtros em planilhas). </p> <p></p>"},{"location":"04-metricas_de_avaliacao/#processo-de-atualizacao_1","title":"Processo de atualiza\u00e7\u00e3o","text":"<p>Ap\u00f3s o processo de Inspe\u00e7\u00e3o no TVI, um arquivo .csv com a consolida\u00e7\u00e3o das classes pontos \u00e9 criado com a seguinte estrutura de cabe\u00e7alho e considerando ';' como separador: </p> <pre><code>gid;lon;lat;d_2000;d_2001;d_2002;d_2003;d_2004;d_2005;d_2006;d_2007;d_2008;d_2009;d_2010;d_2011;d_2012;d_2013;d_2014;d_2015;d_2016;d_2017;d_2018;d_2019;classe\n</code></pre> <p>Os campos lon e lat dever\u00e3o apresentar a longitude e latitude do ponto inspecionado. As colunas 'd_20**' dever\u00e3o apresentar a classe atribu\u00edda ao ponto no respectivo ano e o campo 'classe' dever\u00e1 apresentar a classe final consolidada ap\u00f3s a inspe\u00e7\u00e3o, podendo ser ela Natural, \u00c1gua ou o ano apontado como desmatamento pela inspe\u00e7\u00e3o visual.</p> <p>Ap\u00f3s revis\u00e3o do arquivo .csv, deve-se inserir os resultados alcan\u00e7ados pela valida\u00e7\u00e3o amostral atrav\u00e9s do script insert_validacao_amostral.js. Antes de executar o script, deve-se alterar a linha 9 para a localiza\u00e7\u00e3o do arquivo .csv. Para execu\u00e7\u00e3o da inser\u00e7\u00e3o, fa\u00e7a:</p> <pre><code>node insert_validacao_amostral.js\n</code></pre> <p>Ap\u00f3s inser\u00e7\u00e3o dos pontos no banco de dados, \u00e9 necess\u00e1ria a cria\u00e7\u00e3o das geometrias dos pontos, portanto execute o seguinte comando SQL:</p> <pre><code>UPDATE validacao_amostral SET geom = ST_Transform(ST_SetSRID(ST_MakePoint(cast(lon as float), cast(lat as float)), 4674),4674)\nWHERE geom is null;\n</code></pre> <p>Em seguida, deve-se realizar a intersec\u00e7\u00e3o dos pontos inseridos com os pol\u00edgonos de desmatamento PRODES-Cerrado. Para tal, execute o seguinte comando SQL:</p> <pre><code>UPDATE validacao_amostral SET prodes_id = p.gid\nFROM prodes_cerrado p\nWHERE validacao_amostral.prodes_id IS NULL\nAND ST_INTERSECTS(validacao_amostral.geom, p.geom)\n</code></pre> <p>Por fim, deve-se executar duas queries para anotar quais pontos foram consolidados como desmatamento ou n\u00e3o atrav\u00e9s da atribui\u00e7\u00e3o de valor ao campo <code>aux_desmat</code>, caso seja detectado desmatamento atribui-se <code>1</code>, caso contr\u00e1rio <code>0</code> :</p> <pre><code>UPDATE validacao_amostral\nSET aux_desmat = 1\nWHERE aux_desmat is null AND classe != 'AGUA' AND classe != 'NATURAL' AND classe != 'NAO_OBSERVADO'\n</code></pre> <p>Ap\u00f3s a atribui\u00e7\u00e3o do valor 1 aos pol\u00edgonos que foram detectados em \u00e1reas desmatadas, sobraram apenas pontos que foram anotados com a classe 'AGUA', 'NATURAL' ou 'NAO_OBSERVADO' de modo que estes pontos est\u00e3o com valor <code>null</code> para o campo <code>aux_desmat</code>, portanto:</p> <pre><code>UPDATE validacao_amostral\nSET aux_desmat = 0\nWHERE aux_desmat is null\n</code></pre>"},{"location":"04-metricas_de_avaliacao/#calculo-de-acuracia","title":"C\u00e1lculo de acur\u00e1cia","text":"<p>As acur\u00e1cias do produtor, do usu\u00e1rio e geral, foi calculada a partir da multiplica\u00e7\u00e3o de cada acerto (1) pela probabilidade amostral correspondente a cada estrato.</p> <p></p> <p>Para a constru\u00e7\u00e3o da matriz de confus\u00e3o foram consideradas as classes \"Antr\u00f3pico\" e \"Natural\" no ano de 2019. O resultado pode ser observado na tabela abaixo. </p> <p></p> <p>Considerando os outros anos mapeados, observa-se uma proximidade entre as estimativas da acur\u00e1cia.</p> <p></p> <p>O arquivo com todas as amostras utilizadas no c\u00e1lculo da acur\u00e1cia de 2019 est\u00e1 dispon\u00edvel para download. Ressalta-se que essas amostras devem ser consideradas no processo de valida\u00e7\u00e3o para os pr\u00f3ximos anos, com a substitui\u00e7\u00e3o dos pontos presentes na classe \"Natural\".</p>"},{"location":"04-metricas_de_avaliacao/#analise-automatica","title":"An\u00e1lise autom\u00e1tica","text":""},{"location":"04-metricas_de_avaliacao/#execucao-do-bfast-monitor","title":"Execu\u00e7\u00e3o do BFast-Monitor","text":"<p>Para atualiza\u00e7\u00e3o do Bfast-Monitor, \u00e9 necess\u00e1rio tr\u00eas coisas:</p> <ol> <li>Um Shapefile com os pixels MODIS filtrados para as \u00e1reas onde se deseja verificar se houve quebras na s\u00e9rie temporal.</li> <li>Um arquivo .TIF com toda a s\u00e9rie temporal MODIS que pode ser gerado pelo projeto MODIS Data Cube.</li> <li>Os scripts <code>bfast.R</code> e <code>maxmin.R</code>, ambos inseridos na pasta scripts/bfast no reposit\u00f3rio do Github.</li> </ol>"},{"location":"04-metricas_de_avaliacao/#criacao-do-shapefile-com-os-pixels-modis","title":"Cria\u00e7\u00e3o do Shapefile com os Pixels MODIS","text":"<p>Primeiramente, \u00e9 importante informar que utilizamos a tabela <code>pixel_modis</code> no banco de dados que cont\u00e9m todos os pixels MODIS para a extens\u00e3o do Cerrado, sendo assim necess\u00e1ria a filtragem para apenas os pixels MODIS que se encontram dentro das \u00e1reas desmatadas de interesse. </p> <p>Este filtro pode ser alcan\u00e7ado atrav\u00e9s da constru\u00e7\u00e3o de uma View no banco de dados com os pol\u00edgonos PRODES-Cerrado de interesse. Para exemplificar, criamos uma View que filtram os pol\u00edgonos PRODES-Cerrado detectados em 2019 com o comando SQL abaixo:</p> <pre><code>CREATE OR REPLACE VIEW public.prodes_2019 AS SELECT prodes_cerrado.gid,\nprodes_cerrado.uid,\nprodes_cerrado.origin_gid,\nprodes_cerrado.pathrow,\nprodes_cerrado.view_date,\nprodes_cerrado.source,\nprodes_cerrado.classname,\nprodes_cerrado.areamunkm,\nprodes_cerrado.county,\nprodes_cerrado.uf,\nprodes_cerrado.geom,\nprodes_cerrado.sucept_desmat,\nprodes_cerrado.sucept_desmat_peq,\nprodes_cerrado.sucept_desmat_grd,\nprodes_cerrado.bfm_pct,\nprodes_cerrado.year,\nprodes_cerrado.lat,\nprodes_cerrado.long,\nprodes_cerrado.classefip,\nprodes_cerrado.cd_geocmu\nFROM prodes_cerrado\nWHERE prodes_cerrado.year = 2019;\n</code></pre> <p>Ap\u00f3s a cria\u00e7\u00e3o da View <code>prodes_2019</code>, \u00e9 necess\u00e1ria a cria\u00e7\u00e3o de um Shapefile com os pixels MODIS que intersectam os pol\u00edgonos de desmatamento, contendo os seguintes atributos: {lon, lat, seq_id}, que representam a longitude e latitude do pixel e um identificador \u00fanico do pol\u00edgono onde foi extra\u00eddo o ponto. O Shapefile \u00e9 criado pelo comando shell abaixo:</p> <pre><code>$ pgsql2shp -f &lt;filename.shp&gt; -h &lt;hostname&gt; -u &lt;db_user&gt; -P &lt;db_password&gt; &lt;db_name&gt; \"select ST_X(pixel.geom) as lon, ST_Y(pixel.geom) as lat, p.gid as seq_id, pixel.geom as geom from pixel_modis pixel inner join prodes_2019 p on ST_INTERSECTS(p.geom, pixel.geom)\"\n</code></pre> <p>O comando acima dever\u00e1 criar um arquivo <code>filename.shp</code> com os pixels MODIS para os desmatamentos PRODES-Cerrado 2019 no local onde foi executado.</p>"},{"location":"04-metricas_de_avaliacao/#execucao-do-mdc-e-criacao-da-serie-modis","title":"Execu\u00e7\u00e3o do MDC e cria\u00e7\u00e3o da s\u00e9rie MODIS","text":"<p>Inicialmente \u00e9 necess\u00e1rio realizar o download do projeto MDC. Em seguida, deve-se instalar todas as depend\u00eancias listadas no projeto. Em seguida, extraia o arquivo <code>MRT.zip</code> e altere o par\u00e2metro <code>path_mrt</code> no arquivo <code>mdc/src/conf/datasources.conf</code> para a localiza\u00e7\u00e3o da pasta extra\u00edda. </p> <p>Para iniciar o processamento da s\u00e9rie temporal, execute os passos definidos no Readme.md do projeto MDC, e por fim, execute o comando abaixo que dever\u00e1 criar toda a s\u00e9rie temporal para o Brasil do per\u00edodo de 01 de Janeiro de 2000 at\u00e9 01 de Janeiro de 2020. Portanto, para datas futuras, deve-se alterar os par\u00e2metros <code>-s</code> e <code>-e</code>.</p> <pre><code>$ python sits.py -d modis -p MOD13Q1.006 -r brasil -s 2000-01-01 -e 2020-01-01\n</code></pre> <p>O processamento acima ir\u00e1 criar diversos arquivos .TIF na pasta. Em seguida \u00e9 necess\u00e1rio organizar todos os arquivos .tif em uma pasta \u00fanica. Fora da pasta dos arquivos, deve-se criar um arquivo .txt listando todos os arquivos .tif gerados, portanto pode-se executar os seguintes comandos no bash:</p> <pre><code>$ touch mod13q1_ndvi_list.txt\n$ ls &lt;pasta_com_arquivos_tif&gt;/ &gt; mod13q1_ndvi_list.txt\n</code></pre> <p>Em seguida, acesse a pasta com os TIFs. Inicialmente \u00e9 necess\u00e1rio descobrir qual o valor do par\u00e2metro NoData para os arquivos gerados. Para tal execute o seguinte comando:</p> <pre><code>$ gdalinfo nomedoarquivo.tif\n</code></pre> <p>Ap\u00f3s verificar o valor do NoData, execute o comando abaixo para gera\u00e7\u00e3o do arquivo VRT da s\u00e9rie temporal:</p> <pre><code>$ gdalbuildvrt -srcnodata &lt;NoData_value&gt; -separate -input_file_list ../mod13q1_ndvi_list.txt ../&lt;nome_arquivo_VRT&gt;.vrt\n</code></pre> <p>Por fim, exeute o comando abaixo para cria\u00e7\u00e3o de um arquivo \u00fanico TIF, tamb\u00e9m conhecido como BigTIF. Vale ressaltar que o comando abaixo possui um tempo consider\u00e1vel de processamento, portanto \u00e9 aconselh\u00e1vel execut\u00e1-lo em segundo plano com a ajuda do nohup.</p> <pre><code>$ nohup gdal_translate -co TILED=YES -co COMPRESS=lzw -co BIGTIFF=YES -co INTERLEAVE=PIXEL ../&lt;nome_arquivo_VRT&gt;.vrt ../&lt;nome_arquivo_TIF&gt;.tif &gt; saida.out &amp;\n</code></pre> <p>Para inserir a s\u00e9rie temporal gerada no Cerrado DPAT, \u00e9 necess\u00e1rio mover os arquivos <code>&lt;nome_arquivo_TIF&gt;.tif</code> e <code>&lt;nome_arquivo_VRT&gt;.vrt</code> para dentro da pasta <code>catalog/time_series_db</code> na localiza\u00e7\u00e3o da pasta <code>catalog</code> configurada no OWS Server. Em seguida, altere a propriedade <code>file</code> na chave <code>[MOD13Q1_NDVI]</code> no arquivo de configura\u00e7\u00e3o <code>layers.ini</code> (que disponibiliza a s\u00e9rie temporal via servi\u00e7o no Cerrado DPAT) para <code>&lt;nome_arquivo_TIF&gt;.tif</code>. </p> <p>Vale ressaltar que a s\u00e9rie temporal MODIS criada de Janeiro de 2000 at\u00e9 Agosto de 2020 est\u00e1 atualizada no arquivo <code>DADOS_RASTER_CATALOG_FIP_CERRADO.tar.gz</code> com nome <code>pa_br_mod13q1_ndvi_250_2000_2020.tif</code> dentro da subpasta <code>time_series_db</code>. </p>"},{"location":"04-metricas_de_avaliacao/#execucao-dos-scripts-de-atualizacao-do-bfast","title":"Execu\u00e7\u00e3o dos scripts de atualiza\u00e7\u00e3o do Bfast","text":"<p>Ap\u00f3s a cria\u00e7\u00e3o da s\u00e9rie MODIS para o Brasil, \u00e9 necess\u00e1ria a execu\u00e7\u00e3o do algoritmo Bfast-Monitor para os pixels filtrados. Primeiramente \u00e9 necess\u00e1rio alterar o arquivo <code>bfast.R</code> na linha 38 (descrita abaixo), indicando corretamente a localiza\u00e7\u00e3o do arquivo BigTIF com a s\u00e9rie MODIS processada.</p> <pre><code>ndvi &lt;- brick(\"&lt;localiza\u00e7\u00e3o_arquivo_serie_MODIS.tif&gt;\")\n</code></pre> <p>Em seguida, deve-se executar o script <code>bfast.R</code> (que importa o script <code>maxmin.R</code> para normaliza\u00e7\u00e3o dos dados), informando os par\u00e2metros com a localiza\u00e7\u00e3o do Shapefile criado e quantos pixels MODIS ser\u00e3o analisados, conforme o exemplo abaixo, que indica a localiza\u00e7\u00e3o do shapefile <code>modis_prodes_2019_shp</code> e que dever\u00e3o ser analisados dos pixels 1 at\u00e9 o 123513 (quantidade total de pixels no Shapefile):</p> <pre><code>Rscript bfast.R &lt;path_to_modis_prodes_2019.shp&gt; 1 123513\n</code></pre> <p>Este processamento ir\u00e1 resultar em um arquivo .csv nomeado <code>result.csv</code>. Por fim, basta importar o arquivo .csv no banco de dados utilizando o script <code>insert_bfast_db.js</code>. Primeiramente \u00e9 necess\u00e1rio alterar a linha 9 do script com a localiza\u00e7\u00e3o correta do arquivo <code>result.csv</code>. Por fim, execute o script com o comando.</p> <pre><code>node insert_bfast_db.js\n</code></pre> <p>Em seguida, deve-se criar a geometria dos pontos importados no banco de dados:</p> <pre><code>UPDATE bfast_points\nSET geom = ST_SetSRID(ST_MakePoint(lon, lat), 4674)\nWHERE geom is null;\n</code></pre> <p>Por fim, \u00e9 necess\u00e1ria a atualiza\u00e7\u00e3o do campo <code>bfm_pct</code> na tabela PRODES-Cerrado que dever\u00e1 conter a porcentagem de quebras identificadas em cada pol\u00edgono filtrado, portanto deve-se executar a seguinte query:</p> <pre><code>update prodes_2019\nset bfm_pct = g.div\nfrom (\nselect tt.gid_total,tt.totale,pp.gid_na,pp.total_na, ((cast(pp.total_na as numeric)/ cast(tt.totale as numeric)) * 100) as div from\n(\nSELECT p.gid as gid_total, count(b.geom) AS totale FROM prodes_2019 p\nLEFT JOIN bfast_points b ON ST_INTERSECTS(p.geom,b.geom)\nGROUP BY p.gid\n) as tt\nINNER JOIN\n(\nSELECT p.gid as gid_na, count(b.geom) AS total_na FROM prodes_2019 p\nLEFT JOIN bfast_points b ON ST_INTERSECTS(p.geom,b.geom)\nwhere b.breakpoint &lt;&gt; 'NA'\nGROUP BY p.gid\n) as pp\non pp.gid_na = tt.gid_total\n) as g\nwhere g.gid_total = prodes_2019.gid\n</code></pre>"},{"location":"04-metricas_de_avaliacao/#susceptibilidade-ao-desmatamento","title":"Susceptibilidade ao desmatamento","text":""},{"location":"04-metricas_de_avaliacao/#construcao-das-superficies","title":"Constru\u00e7\u00e3o das superf\u00edcies","text":"<p>As superf\u00edcies de susceptibilidades foram constru\u00eddas a partir da sintese dos principais fatores vinculados a estes fen\u00f4menos. Uma compila\u00e7\u00e3o de m\u00e9tricas espacialmente expl\u00edcitas relacionadas a esses fatores, foi realizada a partir de um processo de revis\u00e3o da literatura, disponibilidade de dados e verifica\u00e7\u00e3o, por meio estat\u00edstico, da signific\u00e2ncia e das correla\u00e7\u00f5es entre dados compilados. O conjunto final foi constitu\u00eddo por 11 m\u00e9tricas: dist\u00e2ncia de \u00e1reas antr\u00f3picas; dist\u00e2ncia de rodovias; dist\u00e2ncia de silos e armaz\u00e9ns; categoria fundi\u00e1ria; tamanho da propriedade; textura e tipo de solo; geomorfologia, declividade, altitude e m\u00e9dia anual da precipita\u00e7\u00e3o acumulada entre os anos de 200 e-2015.</p> Dado Fonte Dist\u00e2ncia de \u00e1reas antr\u00f3picas Calculada a partir da \u00e1rea antr\u00f3pica acumulada do PRODES-Cerrado Dist\u00e2ncia de rodovias Open Street Maps Densidade de silos e armazens CONAB (revisado pelo LAPIG-UFG) Altitude SRTM Delividade SRTM Precipita\u00e7\u00e3o TRMM/INMET (interpola\u00e7\u00e3o realizada pelo LAPIG-UFG) Tamanho da propriedade SICAR Categoria fundi\u00e1ria Propriedades (SICAR) Unidades de Conserva\u00e7\u00e3o (MMA) Terras Indigenas (Funai) Assentamentos (INCRA) Comunidades Quilombolas (INCRA) Geomorfologia BDIA-IBGE Solo (tipologia) BDiA-IBGE Solo (textura) BDiA-IBGE <p>O m\u00e9todo de Pesos de Evid\u00eancia, adaptado para an\u00e1lises espaciais pelo software Dinamica EGO, foi utilizado para verificar a influ\u00eancia de cada m\u00e9trica nos desmatamentos grandes e pequenos ocorridos entre os anos de 2010 e 2015. Este intervalo foi escolhido para que as duas superf\u00edcies geradas fossem aos desmatamentos detectados ap\u00f3s 2016 (in\u00edcio do projeto FIP Monitoramento). A intera\u00e7\u00e3o entre os pesos de cada m\u00e9trica resultou em dois arquivos raster com valores num\u00e9rico entre 0 e 1, indicando, respectivamente, \u00e1reas com baixa e alta susceptibilidade ao desmatamento. Os arquivos de entrada do modelo (m\u00e9tricas e paisagens) est\u00e3o disponibilizados aqui.</p> <p></p> <p>Os procedimentos que ocorreram dentro do software Dinamica EGO est\u00e3o detalhados nas figuras abaixo.  </p> <p>Etapa 1: Categoriza\u00e7\u00e3o das m\u00e9tricas continuas (download do modelo em formato .egoml)</p> <p> </p> <p>Etapa 2: C\u00e1lculo dos coeficientes (pesos) de cada m\u00e9trica  (download do modelo em formato .egoml)</p> <p> </p> <p>Etapa 3: C\u00e1lculo da susceptibilidade ao desmatamento  (download do modelo em formato .egoml)</p> <p> </p> <p>Ao final, as superf\u00edcies geradas foram avaliadas a partir dos seus respectivos cruzamentos com os pol\u00edgonos detectados no ano de 2016.</p> <p></p> <p>Ap\u00f3s a execu\u00e7\u00e3o do modelo para todo o Cerrado, foi realizado o cruzamento das superf\u00edcies geradas com os pol\u00edgonos do PRODES e DETER-Cerrado para os anos de 2016, 2017 e 2018. Para os pol\u00edgonos do PRODES-Cerrado, foi observado que cerca de 51% dos pol\u00edgonos est\u00e3o em \u00e1reas com alta susceptibilidade a desmatamentos grandes o que representa uma \u00e1rea total de 3.496 km\u00b2, de modo que 75% dessa \u00e1rea apresenta susceptibilidade superior a 50%. O mesmo ocorre tamb\u00e9m para os pol\u00edgonos de desmatamento pequenos, que representam uma \u00e1rea total de 4.902 km\u00b2 e 78% da \u00e1rea desses pol\u00edgonos est\u00e1 inserida regi\u00f5es com alta susceptibilidade a desmatamentos pequenos.</p> <p>Da mesma forma, para os pol\u00edgonos do DETER-Cerrado foi observado que apenas 14% dos pol\u00edgonos est\u00e3o em regi\u00f5es com alta susceptibilidade a desmatamentos grandes, por\u00e9m estes 14%, comp\u00f5em um total de 2.855 km\u00b2 e representam aproximadamente 54% de toda a \u00e1rea desmatada no per\u00edodo supracitado, o que atrai uma aten\u00e7\u00e3o especial para este caso, pois embora a quantidade de desmatamentos seja menor, o seu impacto \u00e9 significativo para o contexto. Para os pol\u00edgonos de desmatamento pequenos, que representam 87% do total de pol\u00edgonos e correspondente a 2.437 km\u00b2, 71% destes pol\u00edgonos se encontram em regi\u00f5es com pelo menos 50% de susceptibilidade a desmatamentos pequenos, o que mostra uma boa acur\u00e1cia do m\u00e9todo em proporcionar um indicativo para desmatamentos futuros, fornecendo assim um guia vi\u00e1vel para \u00f3rg\u00e3os governamentais intensificarem a fiscaliza\u00e7\u00e3o em regi\u00f5es com alta susceptibilidade de desmatamentos.</p>"},{"location":"04-metricas_de_avaliacao/#cruzamento-com-suceptibilidade","title":"Cruzamento com suceptibilidade","text":"<p>Ap\u00f3s atualiza\u00e7\u00e3o dos dados PRODES-Cerrado e/ou DETER-Cerrado, \u00e9 necess\u00e1ria a atualiza\u00e7\u00e3o das colunas <code>sucept_desmat_peq</code> e <code>sucept_desmat_grd</code> que representam a susceptibilidade a desmatamentos grandes e pequenos dos pol\u00edgonos PRODES-Cerrado. Para tal, \u00e9 necess\u00e1rio obter os arquivos .TIF com as superf\u00edcies geradadas no link. O arquivo <code>DADOS_RASTER_CATALOG_FIP_CERRADO.tar.gz</code> possui todos dados Raster presentes no DPAT, para tal descompacte a pasta FIP para obter ambas as superf\u00edcies.</p> <p>Primeiramente, deve-se instalar as depend\u00eancias do python e as bibliotecas para execu\u00e7\u00e3o do script <code>run_zonal_susceptibilidade.py</code>. Portanto, execute o script install_dependences.sh: </p> <pre><code>./install_dependences.sh\n</code></pre> <p>Em seguida, acesse o arquivo <code>run_zonal_susceptibilidade.py</code> presente no reposit\u00f3rio do projeto e fa\u00e7a as seguintes modifica\u00e7\u00f5es:</p> <ul> <li>Altere a linha 118 colocando as valores corretos para autentica\u00e7\u00e3o no banco de dados:   <pre><code>connPostgis = \"PG: host=%s port=%s dbname=%s user=%s password=%s\" \\\n  % ('&lt;db_host&gt;', '5432', '&lt;db_name&gt;', '&lt;db_user&gt;',\n'&lt;db_password&gt;')\n</code></pre></li> <li>Em seguida, altere a linha 125 com o nome da tabela ou View do banco de dados que apresenta o conjunto de dados a ser alterado. No exemplo abaixo, os pol\u00edgonos PRODES-Cerrado 2019 s\u00e3o atualizados com a m\u00e9dia dos valores em cada pol\u00edgono: <pre><code>table_name = 'prodes_2019'\n</code></pre></li> <li>Por fim, altere as linhas  128 e 129 com a localiza\u00e7\u00e3o dos arquivos .TIF da superf\u00edcie de susceptibilidade a desmatamentos pequenos e grandes respectivamente.</li> </ul> <p>Ap\u00f3s as altera\u00e7\u00f5es, deve-se executar o script atrav\u00e9s do seguinte comando:</p> <pre><code>$ python run_zonal_suceptibilidade.py\n</code></pre> <p>Por fim, atualize a coluna <code>sucept_desmat</code> que dever\u00e1 armazenar o valor da coluna com maior susceptibilidade para aquele pol\u00edgono.</p> <pre><code>UPDATE prodes_2019 SET sucept_desmat = GREATEST(sucept_desmat_peq, sucept_desmat_grd) WHERE sucept_desmat_peq IS NOT NULL OR sucept_desmat_grd IS NOT NULL;\n</code></pre>"},{"location":"04-metricas_de_avaliacao/#calculo-da-metrica-de-qualificacao","title":"C\u00e1lculo da m\u00e9trica de qualifica\u00e7\u00e3o","text":"<p>Ap\u00f3s a atualiza\u00e7\u00e3o de todas as etapas que compo\u1ebdm a qualifica\u00e7\u00e3o dos pol\u00edgonos PRODES-Cerrado, \u00e9 necess\u00e1rio realizar a atualiza\u00e7\u00e3o de sua qualifica\u00e7\u00e3o no banco de dados. Para tal, assim como detalhado na se\u00e7\u00e3o (inserir link), considera-se os seguintes crit\u00e9rios para a qualifica\u00e7\u00e3o dos pol\u00edgonos PRODES-Cerrado.</p> Classe Crit\u00e9rio SQL query A S\u00e3o considerados pol\u00edgonos classe 'A' aqueles cuja cobertura n\u00e3o foi classificada como 'Vegeta\u00e7\u00e3o nativa' UPDATE prodes_cerrado set classefip = 'A' FROM pontos_campo pt where pt.prodes_id=prodes_cerrado.gid and pt.cobertura != 'Vegeta\u00e7\u00e3o nativa'; B S\u00e3o considerados pol\u00edgonos classe 'B' aqueles cuja valida\u00e7\u00e3o amostral apontou 'desmatamento' como classe predominante e os m\u00e9todos de an\u00e1lise autom\u00e1tica devolveram mais de 50% de confiabilidade da exist\u00eancia de desmatamento. UPDATE prodes_cerrado set classefip = 'B' from (SELECT p.bfm_pct as bfast, p.classefip as cfip, p.sucept_desmat as psuct, p.year as ano, v.prodes_id as idProdes, mode() WITHIN GROUP (ORDER BY v.aux_Desmat) AS modal_value FROM validacao_amostral v INNER JOIN prodes_cerrado p on p.gid = prodes_id where p.year &gt; 2015 and p.classefip is null group by 1,2,3,4,5) as sub WHERE sub.idProdes = prodes_cerrado.gid and sub.modal_value = 1 and (sub.bfast &gt;= 50 and sub.psuct &gt;= 0.5) and sub.cfip is null; C S\u00e3o coniderados pol\u00edgonos classe 'C' aqueles que apenas os m\u00e9todos autom\u00e1ticos poderam ser executados e algum dos m\u00e9todos apresentou mais de 50% de confiabilidade para a exist\u00eancia do desmatamento. UPDATE prodes_cerrado SET classefip = 'C' WHERE prodes_cerrado.year &gt; 2015 and (prodes_cerrado.bfm_pct &gt;= 50 OR prodes_cerrado.sucept_desmat &gt;= 0.5) and prodes_cerrado.classefip is null; D S\u00e3o considerados pol\u00edgonos classe 'D' aqueles que apenas os m\u00e9todos autom\u00e1ticos poderam ser executados e obtiveram a confiabilidade abaixo de 50% para a exist\u00eancia do desmatamento. UPDATE prodes_cerrado SET classefip = 'D' WHERE prodes_cerrado.year &gt; 2015 and (prodes_cerrado.bfm_pct &lt; 50 or prodes_cerrado.sucept_desmat &lt; 0.5) and prodes_cerrado.classefip is null; E S\u00e3o considerados pol\u00edgonos classe 'E' aqueles que foram visitados em campo por\u00e9m foi apontada 'Vegeta\u00e7\u00e3o Nativa' como principal cobertura do solo. UPDATE prodes_cerrado set classefip = 'E' FROM pontos_campo pt where pt.prodes_id = prodes_cerrado.gid and pt.cobertura = 'Vegeta\u00e7\u00e3o nativa'; <p>\u00c9 importante ressaltar que devido aos par\u00e2metros de treinamento dos algoritmos de an\u00e1lise autom\u00e1tica, s\u00f3 \u00e9 poss\u00edvel qualificar pol\u00edgonos detectados ap\u00f3s o ano de 2015.</p>"}]}